function encode(n){if("object"==typeof n)for(var a in n)if("object"==typeof n[a])n[a]=encode(n[a]);else if(Array.isArray(n[a]))for(var o=0;o<n[a].length;o++)n[a][o]="object"==typeof n[a][o]?encode(n[a][o]):encodeURIComponent(n[a][o]);else n[a]=encodeURIComponent(n[a]);else console.log("不是有效的对象");return n}function invoke(n,a,o){var i={domain:n,action:a};appVer.isApp()&&(o&&(i.data=o),console.log("memebox://"+encodeURIComponent(JSON.stringify(i))),location.href="memebox://"+encodeURIComponent(JSON.stringify(i)))}function getNativeUrl(n){return appVer.isIos()?location.origin+"/m/app?app_json="+encodeURIComponent(JSON.stringify(n)):appVer.isAndroid()?"memebox://m.cn.memebox.com?app_json="+encodeURIComponent(JSON.stringify(n)):"/m/app"}function openNative(n){if(appVer.isIos()){if(appVer.isApp())appVer.isWeixin()&&(location.href=location.origin+"/m/app?app_json="+encodeURIComponent(JSON.stringify(n)));else{var a=document.createElement("iframe");a.src="memebox://"+encodeURIComponent(JSON.stringify(n)),a.style.display="none",a.onload=function(){console.log("success")},document.body.appendChild(a)}location.href="memebox://"+encodeURIComponent(JSON.stringify(n))}if(appVer.isAndroid()){if(!appVer.isApp()){var a=document.createElement("iframe");a.src="memebox://"+encodeURIComponent(JSON.stringify(n)),a.style.display="none",a.onload=function(){console.log("success")},document.body.appendChild(a)}location.href="memebox://m.cn.memebox.com?app_json="+encodeURIComponent(JSON.stringify(n))}}function callByJS(n){var a=n.domain+n.action,o={};o.param=n.param||{},n.callback&&(callbacks[a]=n.callback),invoke(n.domain,n.action,n.param)}function appCallback(n,a,o){o=o||{};var i=n+a,e=callbacks[i];if(e)try{e(JSON.parse(o)),delete e}catch(t){e(o),delete e}else;}var callbacks=window.callbacks||{},appVer={iosVer:function(){var n=navigator.appVersion.match(/MWProjectTemplate.*/);return n&&n[0].match(/[\d]/g)&&n[0].match(/[\d]/g).join("")},iosAlias:function(){var n=navigator.appVersion.match(/MemeboxAlias.*/);return n&&n[0].match(/[\d]/g)&&n[0].match(/[\d]/g).join("")},isApp:function(){return this.iosVer()||this.androidVer()||this.iosAlias()},androidVer:function(){var n=navigator.appVersion.match(/MeMeAndroid.*/);return n&&n[0].match(/[\d]/g)&&n[0].match(/[\d]/g).join("")},isIos:function(){return/iphone|ipad|ipod/.test(window.navigator.userAgent.toLowerCase())},isAndroid:function(){return/android/.test(window.navigator.userAgent.toLowerCase())},isWeixin:function(){return/MicroMessenger/.test(window.navigator.userAgent)}},appsdk={cb:function(n,a){"function"==typeof n?n(a):window[n]&&window[n](a)},global:{info:function(n){window.callByJS&&window.callByJS({domain:"global",action:"appInfo",callback:function(a){appsdk.cb(n,a)}})},setTitle:function(n){window.callByJS&&window.callByJS({domain:"global",action:"set_title",param:{title:n}})},product:function(n,a){a=a||location.href,window.callByJS&&window.callByJS({domain:"product",action:"detail",param:{productId:n,url:a}})},toAppProduct:function(n){n.url=n.url||location.href;var a={domain:"product",action:"detail",data:n};return appVer.isApp()||openNative(a),window.getNativeUrl(a)},toAppH5View:function(n,a,o){n=n||location.href,a=a||document.title;var i={domain:"h5page",action:"to_h5page",data:{url:n,title:a,image_url:o}};return appVer.isApp()||openNative(i),window.getNativeUrl(i)},channel:function(n,a){window.callByJS&&window.callByJS({domain:"channel",action:"channel",param:{channelId:n,channelName:a}})},main:function(n){window.callByJS&&window.callByJS({domain:"main",action:"to_main",param:n})},toAppMain:function(n){var a={domain:"main",action:"to_main",param:n};return appVer.isApp()||openNative(a),window.getNativeUrl(a)},h5page:function(n,a,o){window.callByJS&&window.callByJS({domain:"h5page",action:"to_h5page",param:{url:n,image_url:a,title:o}})},back:function(){window.callByJS&&window.callByJS({domain:"global",action:"back"})},login:function(n,a,o){var i={};a&&(i.type=a),o&&(i.channel=o),window.callByJS&&window.callByJS({domain:"user",action:"login",param:i,callback:function(a){appsdk.cb(n,a)}})},register:function(){window.callByJS&&window.callByJS({domain:"user",action:"register"})},toUserCenter:function(){window.callByJS&&window.callByJS({domain:"user",action:"detail"})},toAppLive:function(n){var a={domain:"live",action:"to_live",data:n};return appVer.isApp()||openNative(a),window.getNativeUrl(a)},doTask:function(n,a){window.callByJS&&window.callByJS({domain:"task",action:"do_task",param:n,callback:function(n){appsdk.cb(a,n)}})},openPush:function(n){window.callByJS&&window.callByJS({domain:"task",action:"sign",callback:function(a){appsdk.cb(n,a)}})}},cart:{add:function(n,a,o,i,e){var t={};a&&(t.productID=a),o&&(t.qty=o),i&&(t.options=i),e&&(t.value=e),window.callByJS&&window.callByJS({domain:"cart",action:"addcart",param:t,callback:function(a){appsdk.cb(n,a)}})},to:function(){window.callByJS&&window.callByJS({domain:"cart",action:"to_cart"})}},order:{list:function(n){var a={};n&&(a.menu=n),window.callByJS&&window.callByJS({domain:"order",action:"orderList",param:a})},detail:function(n){var a={};n&&(a.orderId=n),window.callByJS&&window.callByJS({domain:"order",action:"orderDetail",param:a})}},pay:{doPay:function(n,a,o,i){var e={};n&&(e.orderId=n),a&&(e.price=a),o&&(e.dialog=o),window.callByJS&&window.callByJS({domain:"pay",action:"dopay",param:e,callback:function(n){appsdk.cb(i,n)}})}},share:{doShare:function(n,a){window.callByJS&&window.callByJS({domain:"share",action:"share",param:n,callback:function(n){appsdk.cb(a,n)}})},setShare:function(n){window.callByJS&&window.callByJS({domain:"share",action:"setShareInfo",param:n})},native_share:function(n){callbacks&&(callbacks.sharenativeShare=n)}},user:{info:function(n){window.callByJS&&window.callByJS({domain:"user",action:"userinfo",callback:function(a){appsdk.cb(n,a)}})}}};