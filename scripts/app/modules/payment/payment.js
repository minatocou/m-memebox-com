define("/modules/payment/payment",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common","/modules/payment/ga"],function(e){{var t=e("/modules/vue/vue"),r=e("/modules/vue/vue-common"),o=e("/modules/payment/ga");new t({mixins:[r,o],el:"html",param:null,data:{title:"支付",init:!1,money:"0",orderId:null,addressData:{},orderList:{},gift:"",times:[],pay:{wx:!1,ali:!1,global:!1,orderId:null,totalAmount:0,time:""},codeToLabel:{1:"待支付",2:"待发货",3:"待收货",4:"已取消",5:"已完成",6:"待付尾款",7:"关闭"},nowTime:(new Date).getTime(),prompt:{type:"",show:"",price:""}},methods:{closePromptBox:function(){var e=this;e.prompt.show=!1},initPromptBox:function(){var e=this,t=e.getOrderIds();t&&!localStorage[t]&&e.httpAjax({url:"/h5/order/detail",param:{orderId:t},success:function(r){e.codeToLabel[r.data.statusCode]&&(r.data.statusLabel=e.codeToLabel[r.data.statusCode]);var r=r.data;2==r.statusCode&&(e.prompt.price=r.grantTotal,e.prompt.type=r.paymentMethod.match("支付宝")?0:1,localStorage[t]=t,0!=Number(r.grantTotal)&&(e.prompt.show=!0))}})},goBack:function(){var e=this;this.popup({type:"confirm",title:" ",content:"真的要停止付款吗？",btn:["去意已决","我再看看"],n:function(){location.href=e.page+"/payment/my_orders.html"}})},getOrderId:function(e){var t=this;if(e.time>0){var r=(new Date).getTime();e.time=parseInt((e.time-r)/1e3),mui("#select-pay").popover("toggle"),e.orderIds=t.getSearch("orderIds")||t.getOrderIds("orderIds"),t.$refs.pay.payBoxInit(e)}},closeLeftTime:function(e,t){var r=this;r.times.push(t);var o=setTimeout(function(){if(r.times[e]>0){--r.times[e];var t=r.times[e];r.$nextTick(function(){r.closeLeftTime(e,t)})}else clearInterval(o)},1e3)},timer:function(e){var t=this,r=parseInt(e/60/60%24,10),o=parseInt(e/60%60,10),i=parseInt(e%60,10),a={};return a.hh=t.checkTime(r)[0]+""+t.checkTime(r)[1],a.mm=t.checkTime(o)[0]+""+t.checkTime(o)[1],a.ss=t.checkTime(i)[0]+""+t.checkTime(i)[1],a},checkTime:function(e){return e+="",e=10>e?["0",e]:[e.slice(0,1),e.slice(1,2)]},type:function(e){var t={0:["拼 团","group"],1:["韩国仓","korea"],2:["极速仓","china"],4:["保税仓","ftz"],8:["韩国直邮／特快","korea"]},r=[];return r[0]=t[e][0],r[1]=t[e][1],r},getList:function(e){var t=this;t.httpAjax({url:"/h5/newcheckout/orderlist",param:{orderIds:e},success:function(e){var r=e.data;0==r.orderList.length&&t.getSearch("orderIds")&&(r.groupon_id||setTimeout(function(){location.href=t.getOrderIds()?t.page+"/payment/my_order.html?orderId="+t.getOrderIds():t.page+"/payment/my_orders.html"},1e3));var o=!0;if(r.orderList[1]&&"1"==r.orderList[0].type&&"2"==r.orderList[1].type){var i=r.orderList[0];r.orderList[0]=r.orderList[1],r.orderList[1]=i}t.addressData=r.addressData,t.orderList=r.orderList,t.gift=r.gift;for(var a=0;a<t.orderList.length;a++)t.closeLeftTime(a,t.orderList[a].closedLeftTime),"pending"==t.orderList[a].orderStatus&&(o=!1);1!=o||r.groupon_id||(location.href=t.page+"/payment/my_orders.html?orderId="+t.getOrderIds()),t.init=!0,t.$refs.loading.show=!1}})},orderListF:function(){var e=this,t=e.getOrderIds("orderIds");t&&(e.getOrderIds()?e.payOk(e.getOrderIds(),function(){e.getList(t),e.isWeixin()||e.notifyStatus(),"undefined"!=t&&e.initPromptBox()}):e.getList(t))},notifyStatus:function(){var e=this;e.httpAjax({url:"/h5/notify/status",goLogin:!1,alert:"false",param:{tradeNo:e.getOrderIds(),type:"alipay"}})}},ready:function(){var e=this;e.orderListF()},created:function(){this.isWeixin()&&this.getOrderIds("orderIds")&&!this.openId&&this.wxPay()}})}});