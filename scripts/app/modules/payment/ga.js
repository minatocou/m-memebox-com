define("/modules/payment/ga",function(r,a,o){o.exports={methods:{pushPro:function(r,a){var o=this;if(window.ga)try{window.ga("ecommerce:addItem",{id:a,name:r.name,sku:r.sku,category:r.brandName,price:r.price,quantity:r.qty})}catch(e){console.log("ga error")}else setTimeout(function(){o.pushPro(r,a)},500)},payOk:function(r,a){var o=this;window.ga?(window.ga("require","ecommerce"),r&&(_hmt.push(["_trackEvent","finish_order","支付成功"]),o.httpAjax({url:"/h5/payment/success",param:{orderId:r},complete:function(r){r.data.groupon_id?(localStorage.grouponId=r.data.groupon_id,location.href=o.page+"/payment/group.html?grouponId="+r.data.groupon_id):a&&a()},error:function(){a&&a()},success:function(e){if(1==e.code){var d=[];if(ga("ecommerce:addTransaction",{id:r,affiliation:"",revenue:e.data.grantTotal,shipping:e.data.shippingAmount,tax:""}),e.data.orderProductInfo)for(var t=0;t<e.data.orderProductInfo.length;t++){var n=e.data.orderProductInfo[t];d.push({skuId:n.sku,skuName:n.name,category:n.brandName,Price:n.price,Quantity:n.qty}),o.pushPro(n,r,d)}if(e.data.krChildOrders&&e.data.krChildOrders.krChildOrderProductInfo&&e.data.krChildOrders.krChildOrderProductInfo.length>0)for(var t=0;t<e.data.krChildOrders.krChildOrderProductInfo.length;t++){var n=e.data.krChildOrders.krChildOrderProductInfo[t];d.push({skuId:n.sku,skuName:n.name,category:n.brandName,Price:n.price,Quantity:n.qty}),o.pushPro(n,r,d)}if(e.data.localChildOrders&&e.data.localChildOrders.localOrderProductInfo&&e.data.localChildOrders.localOrderProductInfo.length>0)for(var t=0;t<e.data.localChildOrders.localOrderProductInfo.length;t++){var n=e.data.localChildOrders.localOrderProductInfo[t];d.push({skuId:n.sku,skuName:n.name,category:n.brandName,Price:n.price,Quantity:n.qty}),o.pushPro(n,r,d)}_hmt.push(["_trackOrder",{orderId:r,orderTotal:e.data.grantTotal,item:d}]),ga("ecommerce:send"),e.data.groupon_id?(localStorage.grouponId=e.data.groupon_id,location.href=o.page+"/payment/group.html?grouponId="+e.data.groupon_id):a&&a(e)}else o.popup({content:e.msg})}}))):setTimeout(function(){o.payOk(r)},500)}}}});