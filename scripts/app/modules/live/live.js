define("/modules/live/live",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common","/modules/app/app","/modules/live/video","RongIMLib","Long","ByteBuffer","/modules/live/rongyun/protbuf"],function(e){var o=e("/modules/vue/vue"),t=e("/modules/vue/vue-common"),n=e("/modules/app/app"),a=e("/modules/live/video"),i=e("RongIMLib"),r=(e("Long"),e("ByteBuffer"),e("/modules/live/rongyun/protbuf"),i.RongIMClient),c=a("player",function(){a.log("Your player is ready!"),this.play()});vue=new o({mixins:[t,n],el:"html",data:{title:"美美箱直播",init:!1,liveData:{},chatToken:"",appUrl:"",liveRoomId:"",chatRoomId:"",bottomFix:!0,contentData:[]},computed:{anchorName:function(){return this.liveData.anchorName?this.liveData.anchorName:"****"},livePeople:function(){return this.liveData.livePeopleNumber?this.liveData.livePeopleNumber:0},liveLikeCount:function(){return this.liveData.liveLikeCount?this.liveData.liveLikeCount:0}},methods:{getLiveInfo:function(){var e=this;e.httpAjax({url:"/h5/live/roomInfo",param:{liveRoomId:e.liveRoomId},success:function(o){if(e.liveData={},1==o.code){var t;if(e.liveData=o.data.liveInfo,e.chatRoomId=o.data.liveInfo.chatRoomId,t=e.liveData.liveStatus,1==t)return e.popup({type:"alert",content:"直播未开始"}),"直播未开始";if(2==t)return e.initChatRoom(),"直播中";if(4==t||8==t)return e.popup({type:"alert",content:"直播已结束"}),"直播已结束"}},error:function(e){console.error(e)}}),e.init=!0},initChatRoom:function(){var e=this;r.setConnectionStatusListener({onChanged:function(o){switch(o){case i.ConnectionStatus.CONNECTED:var t={msg:"欢迎来到美美直播间，跟主播学扮美秘籍。美美箱提倡健康的直播环境，对直播内容24小时巡查，禁止宣传违法、违规、低俗等不良信息",user:"系统消息:"};e.contentData.push(t),console.log("链接成功");break;case i.ConnectionStatus.CONNECTING:console.log("正在链接");break;case i.ConnectionStatus.DISCONNECTED:console.log("断开连接");break;case i.ConnectionStatus.KICKED_OFFLINE_BY_OTHER_CLIENT:console.log("其他设备登录");break;case i.ConnectionStatus.DOMAIN_INCORRECT:console.log("域名不正确");break;case i.ConnectionStatus.NETWORK_UNAVAILABLE:console.log("网络不可用")}}}),r.setOnReceiveMessageListener({onReceived:function(o){switch(o.messageType){case r.MessageType.TextMessage:var t={msg:o.content.content.replace(//g,"\\表情"),user:o.content.user&&(o.content.user.name||o.content.user.id)||"游客",admin:o.content.user&&o.content.user.id&&o.content.user.id===$(".live-room-name").text().trim()+"_admin"};e.contentData.push(t);break;case r.MessageType.UnknownMessage:if("MBox:SyncChatRoomInfo"!=o.objectName){var n=o.content.message.content,a={0:"加入了房间",1:"退出了房间"};if("MBox:LiveRoomCloseStatus"==o.objectName){if(1==n.type||2==n.type||4==n.type)return e.popup({type:"alert",content:"直播已结束"}),!1;if(8==n.type)return e.popup({type:"alert",content:"直播出错了"}),!1}if("MBox:InOutChatRoomMsg"==o.objectName&&"游客"!=n.name){var t={msg:a[n.type],user:n.name?n.name:null};e.contentData.push(t)}}}}});var o=e.chatRoomId;e.httpAjax({url:"/h5/live/getChatToken",goLogin:!1,success:function(t){1==!t.code?alert(t.msg):(e.chatToken=t.data.chatToken,e.chatToken&&r.connect(t.data.chatToken,{onSuccess:function(e){console.log("Login successfully."+e);var t=50;r.getInstance().joinChatRoom(o,t,{onSuccess:function(){console.log("加入聊天室成功")},onError:function(){console.log("加入聊天室失败")}});var n=10,a=i.GetChatRoomType.REVERSE;r.getInstance().getChatRoomInfo(o,n,a,{onSuccess:function(e){console.log(JSON.stringify(e)),console.log(e.userInfos),console.log(e.userTotalNums)},onError:function(){}})},onTokenIncorrect:function(){console.log("token无效")},onError:function(e){var o="";switch(e){case i.ErrorCode.TIMEOUT:o="超时";break;case i.ErrorCode.UNKNOWN_ERROR:o="未知错误";break;case i.ErrorCode.UNACCEPTABLE_PaROTOCOL_VERSION:o="不可接受的协议版本";break;case i.ErrorCode.IDENTIFIER_REJECTED:o="appkey不正确";break;case i.ErrorCode.SERVER_UNAVAILABLE:o="服务器不可用"}console.log(e)}}))}})},clickPlay:function(){var e=document.querySelector("video").paused;e?(document.querySelector("video").play(),document.querySelector(".liveRoom-play-btn").style.display="none"):(document.querySelector("video").pause(),document.querySelector(".liveRoom-play-btn").style.display="block")},gotoAppPage:function(){var e=this,o={roomId:e.liveRoomId};window.appsdk.global.toAppLive(o),setTimeout(function(){location.href="/m/app/"},2e3)},getUrl:function(){var e={roomId:this.roomId};this.appUrl=appVer.isIos()&&appVer.isWeixin()?window.appsdk.global.toAppLive(e):"javascript:void(0)"}},ready:function(){var e=this;mui.init(),c.on("ended",function(){return e.popup({type:"alert",content:"直播已结束"}),!1}),c.on("error",function(){return e.popup({type:"alert",content:"直播视频出错了"}),!1})},created:function(){var e=this,o="25wehl3u2q21w";r.init(o),e.liveRoomId=e.getSearch("roomId")?e.getSearch("roomId"):null,e.getLiveInfo(),e.getUrl()}})});