define("/modules/group/group",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common","/modules/app/app"],function(t){var o=t("/modules/vue/vue"),r=t("/modules/vue/vue-common"),e=t("/modules/app/app"),n=o.extend({props:["product","showstockout"],template:'<li class="product-list" :class="{\'stockout\':product.stockStatus==\'0\'}">\n    <a @tap="$parent.goDetail()" :href="$parent.getUrl()">\n        <div class="show-img">\n        <span class="icon">\n            <img :src=$parent.getProIcon(product) v-show=$parent.getProIcon(product) alt="美美箱">\n        </span>\n            <div class="stockout-mark" v-show="product.stockStatus==\'0\'">\n                <span>售&nbsp;&nbsp;罄</span>\n            </div>\n            <img class="show-img" :src="product.imgUrl || product.img"/>\n        </div>\n        <div class="product-information">\n            <h2><span class="tag pt">{{product.grouponType==\'1\'?\'拼团\':\'邀新团\'}}</span>{{product.brandName}}\n                {{product.name}}</h2>\n            <div class="tags">\n                <div class="tag discoun">{{(product.grouponPrice/product.price*10).toFixed(1)}}折</div>\n                <div class="tag shipping">包邮</div>\n            </div>\n        </div>\n        <div class="bottom-price">\n            <span class="price">{{product.grouponPrice}}</span>\n            <del class="original-price" v-show="(product.price-product.grouponPrice)>0">\n                {{(product.price-0).toFixed(2)}}\n            </del>\n        </div>\n        <img :src="getIcon($parent.groupDetail.grouponStatus)" v-show="getIcon($parent.groupDetail.grouponStatus)"\n             alt="拼团状态" class="status-img">\n    </a>\n</li>',methods:{getIcon:function(t){var o="status-1.png";return o="3"==t?"status-2.png":this.$parent.btnDis()?"status-3.png":"1"==t||"2"==t?"status-1.png":"status-3.png","/images/app/group/include/"+o}}});o.component("gp",n),vue=new o({mixins:[r,e],el:"html",data:{title:"拼团详情",init:!1,_groupDetail:{},groupDetail:{},shareMask:0,shareMasks:0,product:{},cd:{},groupMax:0,isEnd:!1},methods:{downloadApp:function(){_hmt.push(["_trackEvent","group buying_download","下载APP"])},getUrl:function(){var t=this;return this.isAppGroupon()?void 0:location.origin+this.page+"/productDetails/productDetails.html#"+t.product.productId},goDetail:function(){var t=this;this.isAppGroupon()?this.app_product({productId:t.product.productId}):location.href=location.origin+this.page+"/productDetails/productDetails.html#"+t.product.productId},userInfoCall:function(t){var o=this;t&&t.data&&t.data.token&&(this.errorMsg=t.data.token,localStorage.mmToken=t.data.token),localStorage.mmToken?o.initGroup():setTimeout(function(){o.app_login()},100)},initGroup:function(){var t=this,o={};t.getSearch("grouponId")&&(o.grouponId=t.getSearch("grouponId")),t.getSearch("orderId")&&(o.orderId=t.getSearch("orderId")),t.httpAjax({url:"/h5/newgroupon/detail",param:o,success:function(o){t.groupDetail=o.data,t.groupDetail.updateTime=t.groupDetail.updateTime,t.product=t.groupDetail.productInfo,t.product.grouponType=t.groupDetail.grouponType,t.groupDetail.maxNum=Number(t.groupDetail.maxNum);var r=o.data.endTime-o.data.serverTime;0>=r&&(t.isEnd=!0),t.btnDis(),t.countdown(r,t.cd);var e=o.data.grouponId?location.origin+location.pathname+"?grouponId="+o.data.grouponId:location.href;t.share={title:t.groupDetail.shareTitle,text:t.groupDetail.shareContent,url:e,image:t.groupDetail.shareImg},t.shareGuide(),t.set_share(t.share),t.app_setShare(t.share),!t.isBuy()&&localStorage.grouponId&&(setTimeout(function(){t.app_share(t.share)},100),localStorage.removeItem("grouponId"),localStorage.removeItem("share")),t.groupMax=t.getGroupMax(),t.init=!0}})},btnDis:function(){var t=this;return!t.groupDetail.productInfo||!t.groupDetail.productInfo.grouponPrice||parseFloat(t.groupDetail.productInfo.grouponPrice)<=0||t.isEnd},againBuy:function(){var t=this;if(1==t.groupDetail.productInfo.stockStatus){if(t.isAppGroupon())return this.app_product({productId:t.groupDetail.productInfo.productId});location.href=t.page+"/productDetails/productDetails.html#"+t.groupDetail.productInfo.productId}},shareF:function(){this.isApp()?this.app_share(this.share):(this.shareMask=1,console.log(this.shareMask))},isPayOk:function(t){return"processing"==t||"complete"==t},shareGuide:function(){(localStorage.grouponId||"true"==localStorage.share)&&(this.shareMask=1)},hideGuide:function(){this.shareMask=0,this.shareMasks=0},downPHide:function(){var t=this;t.getAppUrl({wx:"https://lnk0.com/UZBZVt"}),t.hideGuide()},isInGroupDetail:function(){var t=this,o=t.groupDetail.grouponerInfo.filter(function(o){return o.customerId==t.groupDetail.customerInfo.customerId});return 0==o.length},isMe:function(t){return t==this.groupDetail.customerInfo.customerId},payCount:function(){var t=this,o=t.groupDetail.grouponerInfo.filter(function(o){return t.isPayOk(o.processState)});return o.length},isBuy:function(){var t=this,o=t.groupDetail.grouponerInfo.filter(function(o){return o.customerId==t.groupDetail.customerInfo.customerId&&t.isPayOk(o.processState)});return 0==o.length},yf:function(){var t=this,o=t.groupDetail.grouponerInfo.filter(function(o){return o.customerId==t.groupDetail.customerInfo.customerId&&t.isPayOk(o.processState)||o.customerId==t.groupDetail.customerInfo.customerId&&!t.isPayOk(o.processState)});return o.length>0},isHidMe:function(t){var o=this,r=o.groupDetail.grouponerInfo.filter(function(r){return r.customerId==t.customerId&&o.isPayOk(r.processState)});return 0==r.length},getGroupMax:function(){var t=this,o=t.groupDetail.grouponerInfo.filter(function(o){return t.isPayOk(o.processState)||t.isMe(o.customerId)});console.log(t.groupDetail.maxNum,o);var r=t.groupDetail.maxNum-o.length;return r=0>r?0:r},format:function(t,o){var r=new Date(1e3*o),e={"M+":r.getMonth()+1,"d+":r.getDate(),"h+":r.getHours(),"m+":r.getMinutes(),"s+":r.getSeconds(),"q+":Math.floor((r.getMonth()+3)/3),S:r.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(r.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in e)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[n]:("00"+e[n]).substr((""+e[n]).length)));return t},showSelectOption:function(){var t=this;t.btnDis()||1!=t.groupDetail.productInfo.stockStatus||(t.product.addCart=!1,t.product.grouponId=t.getSearch("grouponId"),t.product.activityType="1",t.product.activityId=t.groupDetail.activityId,t.product.orderLimit=t.groupDetail.orderLimit,t.$refs.productdata.showSelectOption(t.product.grouponPrice))},goOrderList:function(){var t=this;t.isApp()?t.app_orderList({menu:"0"}):location.href="../my/orders.html"}},ready:function(){},created:function(){var t=this;t.isApp()?(localStorage.removeItem("mmToken"),t.app_userinfo()):t.initGroup()}})});