define("/modules/app/new-sign/sign",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common","/modules/app/app","/modules/app/new-sign/hammer/hammer"],function(e){if(+new Date<+new Date("2017/5/1"))location.href="/m/app/sign/sign.html";else{var t=e("/modules/vue/vue"),n=e("/modules/vue/vue-common"),a=e("/modules/app/app"),o=e("/modules/app/new-sign/hammer/hammer"),i={panleft:function(e,t,n){t.transform+=-(n*t.translateRatio)},panright:function(e,t,n){t.transform+=n*t.translateRatio}},r=360,s=parseInt(window.getComputedStyle(document.documentElement,null).getPropertyValue("font-size"))/16,u=(document.querySelector(".sign-calendar-date-list"),parseInt(window.getComputedStyle(document.querySelector(".sign-calendar"),null).getPropertyValue("perspective")||window.getComputedStyle(document.querySelector(".sign-calendar"),null).getPropertyValue("-webkit-perspective"))),c=230,l=2*c*Math.PI,p=document.querySelector(".sign-calendar-date-list > li").offsetWidth,d=1e3*parseFloat(window.getComputedStyle(document.querySelector(".sign-memebean-modal-bg-left"),null).getPropertyValue("transition-duration")||window.getComputedStyle(document.querySelector(".sign-memebean-modal-bg-left"),null).getPropertyValue("-webkit-transition-duration"));window.vue=new t({mixins:[n,a],el:"html",data:{week:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],daysList:[],volume:parseInt(window.getComputedStyle(document.querySelector(".sign-power-volume"),null).getPropertyValue("height")),currentDate:"",signinRecord:[],beanIn:!1,experience:0,cacheExperience:0,unsigninRecord:[],favorData:{},offset:p,transform:0,title:"",active:"",getBeansQty:3,notRotate:!1,styleObj:[],beansList:[],taskList:[],pageIndex:1,modalHeight:null,translateRatio:"",currentPushStatus:!1,running:1e3*parseFloat(window.getComputedStyle(document.querySelector(".running"),null).getPropertyValue("transition-duration")||window.getComputedStyle(document.querySelector(".running"),null).getPropertyValue("-webkit-transition-duration")),created:!0,backdropOpacity:!0,appVersion:480===parseInt(appVer.androidVer()||appVer.iosVer())||1e3===parseInt(appVer.androidVer()||appVer.iosVer())},computed:{styleObject:function(){var e=this;return{transform:"rotateY("+parseInt(e.transform)+"deg)"}},stylePosition:function(){var e=this;return{"background-position-y":(100-e.experience)*e.volume/100+"px"}}},filters:{percentage:function(e){return e+"%"}},directives:{rotate:{bind:function(){var e=this,t=e.vm,n=new o(e.el),a=0;n.on("panleft panright",function(e){var n=Math.abs(e.distance-a);a=e.distance,i[e.type]&&i[e.type](e,t,n)}),e.el.addEventListener("touchend",function(e){e.preventDefault(),a=0;var n=Math.abs(t.transform)%r,o=0,i=Math.round(n/(r/t.daysList.length));i=i==t.daysList.length?i-1:i,t.transform<=0?(t.active=i,o=t.transform+n,t.transform=-t.styleObj[i].current+o):(t.active=t.daysList.length-i,o=t.transform-n,t.transform=t.styleObj[i].current+o)})},update:function(){},unbind:function(){}}},methods:{getTodayAndDaysList:function(){var e=this,t=new Date,n=t.getMonth()+1,a=t.getDate(),o=n+"月"+a+"日",i=t.getDay();e.setPageTitle(o+" "+e.week[i]),e.currentDate=a,e.daysList=Array.apply(null,{length:new Date(t.getFullYear(),n,0).getDate()}).map(function(t,n,a){return e.styleObj.push({transform:"rotateY("+n*(r/a.length)+"deg) translateZ("+c*s+"px)",current:n*(r/a.length)}),t=n+1}),e.setDayScale(a)},setPageTitle:function(e){var t=this;t.isApp()?window.appsdk.global.setTitle(e):t.title=e},setDayScale:function(e){var t=this;t.transform=-t.styleObj[e-1].current,setTimeout(function(){t.running=!1,t.active=e-1},t.running)},userInfoCall:function(e){var t=this;if(console.log(e),e&&e.data&&e.data.token)this.errorMsg=e.data.token,localStorage.mmToken=e.data.token;else try{this.errorMsg=JSON.stringify(e)}catch(n){alert(n)}localStorage.mmToken?t.initPage():t.app_login()},getArray:function(e,t){return Array.apply(null,{length:e}).map(function(e){return e=t||{}})},getPageData:function(){var e=this;e.httpAjax({url:"/mobilev48/signin/view",success:function(t){1==t.code?(e.signinRecord=t.data.calendar.signinRecord||[],e.unsigninRecord=t.data.calendar.unsigninRecord||[],e.cacheExperience+=parseInt(t.data.experience)||0,t.data.tasks.forEach(function(e){e.scale=!1}),e.taskList=t.data.tasks||[],t.data.points&&(e.beansList=e.getArray(t.data.points)),e.sign()):mui.alert(t.msg)},error:function(e){mui.alert("操作失败！"),console.log(e)}})},initPage:function(){var e=this;e.translateRatio=r/l*c/u,e.getTodayAndDaysList(),e.getSignStatus(),e.getPageData(),e.getFavorList(),e.initScroll()},initScroll:function(){var e=this;window.onscroll=function(){window.innerHeight+window.scrollY>=document.body.clientHeight&&(0==e.favorData.hasNext?e.noMore||(e.noMore=!0,e.popup({content:"没有更多商品了",time:1e3,autoClose:!0})):1!=e.favorData.hasNext||e.noMore||(e.noMore=!0,e.pageIndex++,e.getFavorList(function(t){1==t.code&&(t.data.items&&(e.favorData.items=e.favorData.items.concat(t.data.items)),1==t.data.hasNext&&(e.noMore=!1),e.favorData.hasNext=t.data.hasNext)})))}},showTaskPage:function(e,t,n){window.appsdk.global.doTask({task_type:n},function(e){console.log(e,"showTaskPage"),location.reload()}),_maq.push(["_trackEvent","check_in_task_ck",{type:n}])},showSignRules:function(){location.href="/m/app/new-sign/sign-rule.html"},getBeansCallback:function(e,t,n){var a=this;a.taskList[t].scale=!0,setTimeout(function(){a.taskList.splice(t,1)},1e3*parseFloat(window.getComputedStyle(document.querySelector(".sign-task-list-item"),null).getPropertyValue("transition-duration")||window.getComputedStyle(document.querySelector(".sign-task-list-item"),null).getPropertyValue("-webkit-transition-duration"))),a.httpAjax({url:"/mobilev48/signin/finishTask",type:"post",param:{task_id:e},success:function(e){1==e.code?a.powerUp(parseInt(e.data.experience),e.data.points):mui.alert(e.msg)}}),_maq.push(["_trackEvent","check_in_fininsh_task_ck",{type:n}])},togglePushStatus:function(){var e=this;e.currentPushStatus?e.toggleSwitch():window.appsdk.global.openPush(function(t){1==t.code&&e.toggleSwitch()})},toggleSwitch:function(){var e=this;e.httpAjax({url:"/h5/signin/switch",param:{"switch":e.currentPushStatus?2:1},success:function(){e.currentPushStatus=!e.currentPushStatus},error:function(e){mui.alert("操作失败！"),console.log(e)}}),_maq.push(["_trackEvent","check_in_ck",{state:e.currentPushStatus?0:1}])},getSignStatus:function(){var e=this;e.httpAjax({url:"/h5/signin/getSwitch",success:function(t){e.currentPushStatus="1"==t.data?!0:!1},error:function(){}})},powerUp:function(e,t){var n=this;n.experience+=e,n.experience>100&&(n.experience=100),n.experience>=100&&n.$nextTick(function(){n.boomBean(t)})},cleanExperience:function(){var e=this;e.backdropOpacity||(e.backdropOpacity=!0,setTimeout(function(){e.experience=0,e.beansList=e.getArray(e.beansList.length+e.getBeansQty)},300))},boomBean:function(e){var t=this;t.getBeansQty=e||0,t.backdropOpacity=!1,t.modalHeight=parseInt(window.getComputedStyle(document.querySelector(".sign-memebean-modal-bg"),null).getPropertyValue("width"))/3.34+"px",setTimeout(function(){t.$nextTick(function(){t.notRotate=!0,setTimeout(function(){t.beanIn=!0},50),setTimeout(function(){t.cleanExperience()},5e3)})},d)},getFavorList:function(e){var t,n=this;if(localStorage.user){var a=JSON.parse(localStorage.user);t=a.userId}else t="";var o={page:n.pageIndex,pageSize:"10",pageType:3,userId:t},i="/mobilev44/recommend/index";n.httpAjax({url:i,param:o,success:function(t){e?e(t):1==t.code&&(n.favorData=t.data)}})},sign:function(){var e=this;e.httpAjax({url:"/mobilev48/signin/sign",alert:!0,success:function(){},complete:function(t){1==t.code?(0==t.data.points&&mui.alert(t.msg),e.signinRecord.push((new Date).getDate()),1!=t.data.isContinuous&&(e.cacheExperience=0),e.powerUp(e.cacheExperience+parseInt(t.data.experience),t.data.points)):e.experience=e.cacheExperience,e.taskList.forEach(function(t,n){1==t.status&&e.$nextTick(function(){e.getBeansCallback(t.task_id,n,t.type)})})},error:function(t){e.experience=e.cacheExperience,console.log(t)}})}},ready:function(){},watch:{currentPushStatus:function(){}},created:function(){var e=this;e.isApp()?(localStorage.removeItem("mmToken"),e.app_userinfo()):e.initPage()}})}});