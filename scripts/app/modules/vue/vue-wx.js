define("/modules/vue/vue-wx",function(e,t,a){a.exports={data:function(){return{wxConfig:null,appid:"wx0deda0920b9a3e80",openId:"",unionOpenId:null,wxError:null}},methods:{get_wxSdk:function(e){window.wx&&e()},addUrlPara:function(e,t,a){a=a||window.location.href;var o=a.split("#")[0];return/\?/g.test(o)?/name=[-\w]{4,25}/g.test(o)?o=o.replace(/name=[-\w]{4,25}/g,e+"="+t):o+="&"+e+"="+t:o+="?"+e+"="+t,a.split("#")[1]?o+"#"+a.split("#")[1]:o},delParam:function(e,t){var a=e.substr(e.indexOf("?")+1),o=e.substr(0,e.indexOf("?")),n="",r=new Array;if(""!=a)for(var i=a.split("&"),d=0;d<i.length;d++){var c=i[d].split("=");c[0]!=t&&r.push(i[d])}return r.length>0&&(n="?"+r.join("&")),e=o+n},set_share:function(e){var t=this,a=e.link||e.url,o={set:"wechat"};localStorage.user&&(a=t.addUrlPara("suid",JSON.parse(localStorage.user).userId,a),o.suid=JSON.parse(localStorage.user).userId),o.suuid=localStorage.uuid?localStorage.uuid:t.getUuid(),a=t.addUrlPara("suuid",localStorage.uuid),localStorage.uuid2&&(o.suuid2=localStorage.uuid2,a=t.addUrlPara("suuid2",localStorage.uuid2)),o.sell=a,t.signature(null,function(){wx.ready(function(){wx.onMenuShareTimeline({title:e.title,link:a,imgUrl:e.imgUrl||e.image,trigger:function(){},success:function(){o.set="h5_moment",_maq&&_maq.push(["_trackEvent","app_share",o]),vue.appShareCall&&vue.appShareCall({code:1})},cancel:function(){},fail:function(){}}),wx.onMenuShareAppMessage({title:e.title,desc:e.desc||e.text,link:a,imgUrl:e.imgUrl||e.image,trigger:function(){},success:function(){o.set="h5_friends",_maq&&_maq.push(["_trackEvent","app_share",o]),vue.appShareCall&&vue.appShareCall({code:1})},cancel:function(){},fail:function(){}})})},e.success)},getPayUrl:function(e){return"https://open.weixin.qq.com/connect/oauth2/authorize?appid="+this.appid+"&redirect_uri="+encodeURIComponent(e)+"&response_type=code&scope=snsapi_base&state=STATE&connect_redirect=1#wechat_redirect"},getCode:function(){var e=this;return e.getSearch("code")?e.getSearch("code"):void(location.href=e.getPayUrl(location.href))},getWxOpenId:function(e){var t=this;if(localStorage.mmoid||localStorage.openId)return t.openId=localStorage.mmoid||localStorage.openId,e&&e(),t.openId;var a=t.getCode();if(a){var o={code:a,source:"h5",state:t.getSearch("state")};t.httpAjax({url:"/sns/callback/wechat",param:o,alert:!0,complete:function(a){2==a.code?(localStorage.unionOpenId=a.data.openId,localStorage.openId=a.data.wechatOpenId,localStorage.mmoid=a.data.wechatOpenId,t.unionOpenId=a.data.openId,t.openId=a.data.wechatOpenId,e&&e(a)):1==a.code?(localStorage.mmToken=a.data.token,e&&e(a)):location.href=t.getPayUrl(t.delParam(location.href,"code"))}})}},getOpenId:function(){var e=this;if(localStorage.mmoid)return e.openId=localStorage.mmoid,e.openId;var t=e.getCode();t&&e.httpAjax({url:"/h5/wechat/getOpenId",param:{code:t},success:function(t){return 1==t.code?(localStorage.mmoid=t.data.openId,e.openId=t.data.openId,e.openId):void 0}})},wxPay:function(e,t){var a=this;if(e=e||{},a.isInWeixin())if(t=e.orderId||a.getOrderIds()||a.getSearch("orderIds")&&a.getSearch("orderIds").split(",")[0],a.openId){var o=a.getPayUrl(location.href);a.httpPost({url:e.wxUrl||"/h5/wechat/pay",param:{code:a.getSearch("code"),openid:a.openId,orderId:t},alert:!1,success:function(n){function r(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:n.data.appId,timestamp:n.data.timeStamp,timeStamp:n.data.timeStamp,nonceStr:n.data.nonceStr,"package":n.data.package,signType:n.data.signType,paySign:n.data.paySign},function(n){"get_brand_wcpay_request:ok"==n.err_msg?a.httpAjax({url:"/h5/notify/status",goLogin:!1,alert:"false",param:{tradeNo:t,type:"wechat"},complete:function(){if(e.wxOk){try{e.wxOk(n)}catch(t){alert(t)}console.log(e.wxOk)}else localStorage.removeItem("mmoid"),localStorage.removeItem("openId"),location.href=o}}):(localStorage.removeItem("mmoid"),localStorage.removeItem("openId"),location.href="/m/payment/fail.html?orderId="+e.orderId)})}a.orderId=e.orderId,1==n.code?"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",r,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",r),document.attachEvent("onWeixinJSBridgeReady",r)):r():(localStorage.removeItem("mmoid"),location.href=o)},complete:function(e){0==e.code&&(localStorage.removeItem("mmoid"),localStorage.removeItem("openId"),a.openId=null,a.getOpenId())}})}else a.getOpenId()},isInWeixin:function(){return/MicroMessenger/i.test(navigator.userAgent)},signature:function(e,t){var a=this,o={url:location.href};e&&(o.err=e),this.isInWeixin()&&(a.wxConfig?(wx.config(a.wxConfig),t&&t(o,e)):a.httpPost({url:"/h5/wechat/getsignpackage",param:o,showLoading:!0,success:function(o){a.wxConfig={debug:/debug=1/.test(location.search),appId:o.data.appId,timestamp:o.data.timestamp,timeStamp:o.data.timestamp,nonceStr:o.data.nonceStr,signature:o.data.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","chooseWXPay"]},wx.config(a.wxConfig),wx.error(function(e){a.wxError=e,/debug=1/.test(location.search)&&alert(JSON.stringify(e)),a.signature(e),a.signature=function(){}}),t&&t(o,e)}}))}}}});