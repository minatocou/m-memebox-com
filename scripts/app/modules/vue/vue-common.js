define("/modules/vue/vue-common",["require","exports","module","/modules/vue/vue","/modules/vue/vue-validator","/modules/vue/vue-platform","/modules/vue/vue-extend","/modules/vue/vue-wx","/modules/vue/vue-component","/modules/vue/vue-filter","/modules/vue/vue-config","mui"],function(e,o,t){var a=e("/modules/vue/vue");a.use(e("/modules/vue/vue-validator"));var r=e("/modules/vue/vue-platform"),i=e("/modules/vue/vue-extend"),n=e("/modules/vue/vue-wx");e("/modules/vue/vue-component"),e("/modules/vue/vue-filter"),e("/modules/vue/vue-config");var s=e("mui");t.exports={mixins:[n,r,i],data:function(){return{log:{time:[]},port:"",page:"/m",searchDomain:window.SEARCH_CTX||"https://search.cn.memebox.com",domain:window.CTX||"//cn.memebox.com",ajaxs:{},share:{title:document.title,text:"全球知名化妆品平台- 美美箱MEMEBOX",url:location.href,image:"http://img-cn1001.memebox.com/media/app/default/icon-old-180_1.png"}}},created:function(){window.host&&window.host!=location.origin&&(location.href=window.host+location.pathname+location.search+location.hash),this.getSearch("token")&&(localStorage.mmToken=this.getSearch("token")),this.getSearch("cleanToken")&&localStorage.removeItem("mmToken"),this.getSearch("app")&&appsdk.global.toAppMain(),this.isFanliApp(),this.commonShare||this.set_share(this.share),localStorage.uuid||(localStorage.uuid=this.getUuid()),this.log.time.push({created:(new Date).getTime()-window.pageStart})},ready:function(){(this.iosVer()||this.androidVer())&&this.rmHeader(),this.setTitle(),s(".mui-slider").slider(),s(".mui-scroll-wrapper.mui-slider-indicator.mui-segmented-control").scroll({scrollY:!0,scrollX:!0,indicators:!1,snap:".mui-control-item"}),s.back=function(){history.back()},this.log.time.push({ready:(new Date).getTime()-window.pageStart}),this.getSearch("suuid")&&(_maq&&_maq.push(["_trackEvent","open_share",{suuid2:this.getSearch("suuid"),suuid:localStorage.uuid,sell:location.href,spathname:location.pathname,set:this.getSearch("set"),suid:this.getSearch("suid")}]),localStorage.uuid2=this.getSearch("suuid"))},methods:{isShowMB:function(){return!0},httpGet:function(e){this.httpAjax(e)},httpPost:function(e){e=e||{},e.type="post",this.httpAjax(e)},setTitle:function(e){var o=this,t=e||o.title||document.title;document.title=t,e&&o.app_set_title&&setTimeout(function(){o.app_set_title({title:e})},10)},rmHeader:function(e){var o=e||document.querySelector("header"),t=document.querySelector("header,.mui-navbar");if(t&&(t.style.display="none"),o&&o.parentNode){console.log(123),o.style.display="none";var a=o.parentNode;a.removeChild(o),console.log(o)}else console.log(123),this.rmSpaHeader()},rmSpaHeader:function(){var e=document.querySelectorAll(".mui-navbar,.mui-navbar-inner");console.log(e);for(var o=0;o<e.length;o++)if(e[o]&&e[o].parentNode){var t=e[o].parentNode;t.removeChild(e[o])}},httpAjax:function(e){var o=this;setTimeout(function(){o.$refs.loading&&!e.showLoading?o.$refs.loading.show=!0:null},0),e.param=e.param||{},localStorage.mmToken&&0!=e.token?e.param.token=localStorage.mmToken:null;var t=e.domain+e.url+(e.param?JSON.stringify(e.param):"");if(!o.ajaxs[t]){e.domain=e.domain||o.domain,o.ajaxs[t]=1;var a={};a[e.url]=(new Date).getTime()-window.pageStart,s.ajax(e.domain+e.url,{data:e.param,dataType:e.dataType||"json",type:e.type||"GET",timeout:e.timeout||6e4,headers:e.headers,success:function(r,i,n){if(a["b"+e.url]=(new Date).getTime()-window.pageStart,o.log.time.push(a),2!=r.code||!e.goLogin&&0==e.goLogin)if("商品库存不足，请修改购物车"==r.msg||r.msg&&r.msg.match("订单创建失败.*"))o.popup({content:r.msg,type:"alert",autoClose:!1,ok:function(){o.go(o.page+"/cart/cart.html")}});else if(0==r.code)e.complete&&e.complete(r,i,n),e.alert&&0!=e.alert||o.popup({content:r.msg,type:"alert",autoClose:!1,ok:function(){1==location.search.search("orderIds")&&(location.href="/m/payment/my_orders.html")}});else{if(e.forCache)try{sessionStorage.setItem(e.url+JSON.stringify(e.param),JSON.stringify(r)),console.log("支持sessionStorage.setItem")}catch(s){console.log(s),console.log("不支持sessionStorage.setItem")}e.success&&e.success(r,i,n),e.complete&&e.complete(r,i,n)}else{var l=location.href;localStorage.ref=l,localStorage.removeItem("mmToken"),o.popup({content:"请登陆",time:1e3,ok:function(){o.isApp()?o.app_login({source:e.source}):o.h5_login(null,e.source)}}),e.complete&&e.complete(r,i,n)}o.$refs.loading&&!e.showLoading&&setTimeout(function(){o.$refs.loading.show=!1},100),delete o.ajaxs[t]},error:e.error||function(a){o.$refs.loading&&!e.showLoading?o.$refs.loading.show=!1:null,delete o.ajaxs[t],_maq.push(["_trackErrorEvent",{tag:a.responseURL,level:"error",code:a.status,msg:a.statusText}])}})}},getSearch:function(e,o){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=o?o.substr(1).match(t):decodeURIComponent(window.location.search).substr(1).match(t);return null!=a?a[2]:null},valiForm:function(e,o){if(o=o||this.$validation,o.valid)e&&e();else{var t=o.messages,a=[];for(var r in t)a.unshift(t[r]);for(var i in a[0])return void this.popup({content:a[0][i]})}},go:function(e){location.href=e},goDetail:function(e){e.price&&e.price>0&&(location.href=this.page+"/productDetails/productDetails.html#"+e.productId)},getUser:function(){return localStorage.user&&JSON.parse(localStorage.user)},isLogin:function(){return localStorage.user||localStorage.mmToken?!0:!1},getUserName:function(){var e=this.getUser()&&this.getUser().userName||"Memebox Member";return e},changeHash:function(e){history.pushState({hash:location.hash},null,e)},goHome:function(){this.go("../home/home.html")},md5:function(e){return window.hex_md5(e)},shareBottom:function(){return this.isQQB()&&!this.isQQ()||this.isUc()||this.isBaidu()||this.isSafari()&&this.isIos()},getIconByType:function(e){var o={bonded:"/images/app/ftz.png",china:"/images/app/china.png",korea:"/images/app/korea.png"};return o[e]},getProIcon:function(e,o){if(0==e.price)return"/images/app/give.png";if("bonded"==this.getSearch("type"))return"/images/app/ftz.png";if(!o||1!=o.isGroupon&&1!=o.activityType){if(!e||1!=e.isGWP&&1!=e.is_GWP){var t={2:"/images/app/china.png",1:"/images/app/korea.png",4:"/images/app/ftz.png",8:"/images/app/epass.png",isGWP:"/images/app/give.png",is_GWP:"/images/app/give.png",isGroupon:"/images/app/group.png"};for(var a in e)if(1==e[a]&&t[a])return t[a];return t[e.warehouse]}return"/images/app/give.png"}return console.log(99),"/images/app/group.png"},getAppUrl:function(e){var o=this;e=e||{},location.href=o.isWeixin()||o.isQQ()||o.isQQB()?e.wx||"http://a.app.qq.com/o/simple.jsp?pkgname=com.memebox.cn.android&ckey=CK1334853810944":o.isIos()?"https://itunes.apple.com/cn/app/memebox-mei-mei-xiang/id960677490?mt=8":"http://pkg-cn1001.memebox.com/android/app/app-memebox_upgrade.apk"},getOrderIds:function(e){var o=this.getSearch("orderId"),t=this.getSearch("orderIds"),a={orderId:o,orderIds:t};return o&&(o.split("_").length>1?(a.orderIds=o.split("_")[1],a.orderId=o.split("_")[0]):a.orderIds=o),t&&(a.orderIds=t),"orderIds"==e?a.orderIds:a.orderId},goApp:function(){var e=this,o=new Date;setTimeout(function(){var t=new Date;5e3>t-o?e.getAppUrl():window.close()},25),window.location="memebox://"},countdown:function(e,o,t,r){function i(e){s=setInterval(function(){e>=0?(n(e),e--):(clearInterval(s),t&&location.reload(),"function"==typeof r&&r())},1e3)}function n(e){function t(e){return 10>e?"0"+e:e.toString()}var r=parseInt(e/60/60/24,10),i=parseInt(e/60/60%24,10),n=parseInt(e/60%60,10),s=parseInt(e%60,10);a.set(o,"day",r),a.set(o,"hour",t(i)),a.set(o,"minute",t(n)),a.set(o,"second",t(s))}var s;i(e)},formatDate:function(e){var o=new Date(1e3*e),t={year:o.getFullYear(),month:o.getMonth()+1,day:o.getDate(),hour:o.getHours(),minute:o.getMinutes(),second:o.getSeconds()};for(var a in t)t[a]<10&&"year"!=a?t[a]="0"+t[a]:t[a];return t},toFixed2:function(e){return e&&parseFloat(e).toFixed(2)},loginCall:function(e){e&&e.data&&e.data.token||this.popup({content:"登录失败",type:"alert",ok:function(){history.back()}})},h5_login:function(e,o,t){function a(e,o){var t="/sns/"+e+"/login?source=h5";o&&(localStorage.source=o,t+="&channel="+o),console.log(CTX+t),location.href=CTX+t}var r=this;if(o&&(localStorage.source=o),console.log(e,o,"source"),e)a(e,o);else if(r.isWeibo())a("weibo",o);else if(r.isWeixin())a("wechat",o);else if(r.isQQ())a("qq",o);else if("function"==typeof t)t();else if(!location.href.match("/account/login.html")){var i=r.page+"/account/login.html";o&&(i+="?source="+o,localStorage.source=o),localStorage.ref=location.href,r.go(i)}},otherLoginCallBack:function(){var e,o=this,t=o.getSearch("code"),a=o.getSearch("state");a.match("qq")?e="qq":a.match("wechat")?e="wechat":a.match("weibo")&&(e="weibo");var r={code:t,source:"h5",state:a};o.httpAjax({url:"/sns/callback/"+e,param:r,goLogin:!1,alert:!0,success:function(e){var t,a=e.code,r=e.data.successUri;if(localStorage.successUri=r,2==a){var i;t="/m/bindPhone/bindPhone.html",localStorage.bindInfor=JSON.stringify(e.data),localStorage.source&&(i=localStorage.source),i=o.getSearch("source")||localStorage.source,console.log(i,"source"),i&&(t+="?source="+i),location.href=t}else 1==a&&(localStorage.mmToken=e.data.token,t=localStorage.ref,localStorage.removeItem("ref"),location.href=t||location.origin+"/m/my/home.html",localStorage.user=JSON.stringify(e.data),localStorage.mmToken=e.data.token,localStorage.removeItem("userName"))}})},toLogin:function(e){localStorage.ref=location.href,localStorage.removeItem("mmToken"),this.isApp()?this.app_login({source:e}):this.h5_login(null,e)},getUuid:function(){for(var e=[],o="0123456789abcdef",t=0;36>t;t++)e[t]=o.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=o.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var a=e.join("");return a},getPlatform:function(){return this.isWeixin()?"wechat":this.isIosApp()?"iOS":this.isAndroidApp()?"Android":"h5"}}}});