define("/modules/bindPhone/bindPhone",["require","exports","module","/modules/vue/vue","/modules/vue/vue-validate","/modules/vue/vue-validator","/modules/vue/vue-common"],function(e){var o=e("/modules/vue/vue"),a=e("/modules/vue/vue-validate");o.use(e("/modules/vue/vue-validator"));{var t=e("/modules/vue/vue-common");new o({mixins:[t,a],el:"html",data:{init:"",showTime:{show:!1,time:60},param:{phone:"",imgAuth:""},authCode:"",imgAuth:""},methods:{getAuth:function(){var e=this,o=/^1[34578]{1}\d{9}$/,a=e.param.phone,t=e.param.imgAuth;if(0==a.search(o)&&11==a.length&&""!=t){e.showTime.show=!0;var l=setInterval(function(){e.showTime.time--,0==e.showTime.time&&(clearInterval(l),e.showTime.show=!1,e.showTime.time=60)},1e3);e.httpAjax({url:"/h5/sms/getAuth",param:{userName:e.param.phone,vcode:e.param.imgAuth.toLocaleUpperCase(),type:"bindPhone"},success:function(o){e.popup({content:o.msg})},alert:"false",complete:function(o){"0"==o.code&&(e.popup("您的手机号已在我们网站注册, 请联系客服"==o.msg?{content:"您的手机号已在我们网站注册，本券仅新用户可领哦",type:"alert",autoClose:!1}:"不是手机号码"==o.msg?{content:"手机号格式有误",type:"alert",autoClose:!1}:{content:o.msg,type:"alert",autoClose:!1}),clearInterval(l),e.showTime.show=!1,e.showTime.time=60)}})}else e.popup(0!=a.search(o)||11!=a.length?{content:"请输入11位正确的手机号码",time:2e3}:{content:"请输入图形验证码",time:2e3})},getImgAuth:function(){var e=this;e.imgAuth=CTX+"/tool?time"+(new Date).getTime()},bind:function(){var e=this;console.log(e.param.phone),e.valiForm(function(){var o=localStorage.bindInfor?JSON.parse(localStorage.bindInfor):{};o.userName=e.param.phone,o.authCode=e.authCode,o.successUri=localStorage.successUri||location.origin+"/m/my/home.html",(e.getSearch("source")||localStorage.source)&&(o.source=e.getSearch("source")||localStorage.source),(e.getSearch("channel")||localStorage.channel)&&(o.channel=e.getSearch("channel")||localStorage.channel),e.isWeixin()&&!o.channel&&(o.channel="wechat"),localStorage.activityType&&(o.type=localStorage.activityType),e.httpAjax({url:"/sns/callback/bind",param:o,success:function(e){localStorage.mmToken=e.data.token,localStorage.user=JSON.stringify(e.data),localStorage.isNew=1,(localStorage.source||localStorage.channel)&&(localStorage.removeItem("channel"),localStorage.removeItem("source")),_maq.push(["_trackEvent","success_register",{suuid:localStorage.uuid,suuid2:localStorage.uuid2,source:localStorage.source,ref:localStorage.ref}]),location.href=localStorage.ref?localStorage.ref:location.origin+"/m/my/home.html"}})})}},ready:function(){var e=this;e.getImgAuth(),e.init=!0,e.$refs.loading.show=!1},created:function(){}})}});