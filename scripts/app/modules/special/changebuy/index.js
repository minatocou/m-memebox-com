define("/modules/special/changebuy/index",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common"],function(e){{var t=e("/modules/vue/vue"),r=e("/modules/vue/vue-common");new t({mixins:[r],el:"html",data:{init:!1,dataProductList:[],showResult:"",orderTotal:null,move:{mask:!1,box:!1,disable:!1},paramObj:{order:"",filter:"",warehouse:"",pageIndex:"",pageSize:"",sku:"",category_ids:""},search:"",extra:{title:"",tips:"",amount:"",margin:"",limit:"",level:"",type:""},addExProList:[],activity_id:"",changeBuyList:"",changeBuyPro:{},currentLength:0},methods:{checkExProQty:function(){return document.querySelectorAll('input[type="checkbox"]:checked').length==this.extra.limit?!1:!0},initMui:function(){function e(){var e=setTimeout(function(){e=null,mui("#pullrefresh").pullRefresh().endPullupToRefresh(),t.paramObj.pageIndex*t.paramObj.pageSize>=t.orderTotal?(t.popup({content:"没有更多商品了",time:1e3,autoClose:!0}),mui("#pullrefresh").pullRefresh().endPullupToRefresh(!0)):(t.paramObj.pageIndex++,t.getList())},0)}var t=this;mui.init({pullRefresh:{container:"#pullrefresh",up:{contentrefresh:"正在加载...",contentnomore:"",callback:e}}})},bindleChangeSortType:function(e){var t=this;t.paramObj.pageIndex=1,t.dataProductList=[],e||(e=4!=t.paramObj.order&&3!=t.paramObj.order?3:12/t.paramObj.order),t.paramObj.order=e,mui("#pullrefresh").pullRefresh().scrollTo(0,0,100),mui("#pullrefresh").pullRefresh().refresh(!0),t.getList()},checkSortType:function(){return 1==arguments.length?this.paramObj.order==arguments[0]&&"sort-title-active":2==arguments.length?(arguments[0]==this.paramObj.order||arguments[1]==this.paramObj.order)&&"sort-title-active":void 0},showChangePro:function(){var e=setTimeout(function(){e=null},1);this.move.mask=!0,this.move.box=!0},hideChangePro:function(){this.move.mask=!1,this.move.box=!1},getList:function(e){var t=this;t.httpAjax({url:"/global/search",domain:t.searchDomain,param:t.paramObj,success:function(r){t.showResult=!0,t.orderTotal=r.orderTotal,"function"==typeof e&&e(),mui("#pullrefresh").pullRefresh().refresh(!0),t.dataProductList=t.dataProductList.concat(r.data),t.init=!0;var i=setTimeout(function(){i=null,t.initEcho()},10)}})},getChangeBuyList:function(){var e=this;e.httpAjax({url:"/h5/cart/exbuyList",param:{activity_id:e.activity_id,condition:e.extra.level},success:function(t){e.changeBuyList=t.data}})},addCart:function(){var e=this,t=document.querySelectorAll('input[type="checkbox"]:checked');e.addExProList=[];for(var r=0,i=t.length;i>r;r++){{var a=t[r].parentNode.parentNode.querySelector(".activity");t[r].parentNode.parentNode.querySelector(".pro-options")}e.addExProList[r]={},e.addExProList[r].product_id=t[r].getAttribute("id"),a&&(e.addExProList[r].optionKey=a.getAttribute("key"),e.addExProList[r].optionValue=a.getAttribute("value"))}console.log(e.addExProList),e.httpAjax({url:"/h5/cart/addExbuy",param:{products:JSON.stringify(e.addExProList),activity_id:e.activity_id,warehouse:e.changeBuyList.warehouse},success:function(e){console.log(e),location.href="/m/cart/cart.html"}})},onlyOne:function(){var e=document.querySelector(".activity"),t=document.querySelectorAll('input[type="checkbox"]:checked');e&&(e.className=e.className.replace("activity",""));for(var r=0,i=t.length;i>r;r++)t[r].checked=!1;this.currentLength=1},choiceOption:function(e){var t=e.target.parentNode.querySelector(".activity"),r=e.target.parentNode.parentNode.parentNode.querySelector("input[type='checkbox']");return 0!=this.extra.margin?!1:this.checkExProQty()&&0==this.extra.margin||1==this.extra.limit||t?(1==this.extra.limit?this.onlyOne():this.currentLength++,t&&(t.className=t.className.replace("activity","")),e.target.className+=" activity",void(r.checked||(r.checked=!0))):!1},choicePro:function(e){var t=e.target;if(this.checkExProQty(),0!=this.extra.margin)return!1;"input"!==t.nodeName.toLocaleLowerCase()&&(t=t.childNodes);var r=t.parentNode.parentNode;t.checked?(1==this.extra.limit?(this.onlyOne(),e.target.checked=!0):this.currentLength++,!r.querySelector("span.activity")&&r.querySelector(".abled")&&(r.querySelector(".abled").className+=" activity")):(r.querySelector("span.activity")&&(r.querySelector("span.activity").className=r.querySelector("span.activity").className.replace("activity","")),this.currentLength--)},goCart:function(){location.href="/m/cart/cart.html"}},ready:function(){this.init=!0;for(var e in this.paramObj)this.paramObj[e]=this.getSearch(e),this.paramObj[e]||delete this.paramObj[e];for(var e in this.extra)this.extra[e]=this.getSearch(e);0==this.extra.margin?this.showChangePro():this.move.disable=!0,this.setTitle(this.extra.title),this.activity_id=this.getSearch("activity_id"),this.getList(function(){this.initMui()}.call(this)),this.getChangeBuyList()},created:function(){},watch:{currentLength:function(e){var t=document.querySelectorAll('input[type="checkbox"]');if(e==this.extra.limit&&1!=this.extra.limit)for(var r=0,i=t.length;i>r;r++)!t[r].checked&&(t[r].disabled=!0);else if(document.querySelector('input[type="checkbox"]:disabled'))for(var r=0,i=t.length;i>r;r++)t[r].disabled=!1}}})}});