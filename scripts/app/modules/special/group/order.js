define("/modules/special/group/order",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common","/modules/vue/vue-validator","/modules/vue/vue-validate","/modules/app/app"],function(e){var a=e("/modules/vue/vue"),o=e("/modules/vue/vue-common");a.use(e("/modules/vue/vue-validator"));var r=e("/modules/vue/vue-validate"),t=e("/modules/app/app");vue=new a({mixins:[o,t,r],el:"html",data:{title:"拼团确认",init:!1,param:{},addressText:null,pay:{wx:!1,ali:!1,global:!1,orderId:null},historyOrder:{}},methods:{selectCity:function(e){e.target.focus();var a=this,o=new mui.PopPicker({layer:3});o.setData(cityData3),o.show(function(e){a.addressText=(e[0]||{}).text+" "+(e[1]||{}).text+" "+((e[2]||{}).text||(e[1]||{}).text),a.param.province=(e[0]||{}).text,a.param.postcode=(e[0]||{}).value,a.param.city=(e[1]||{}).text,a.param.district=(e[2]||{}).text||(e[1]||{}).text,a.param.provinceId=(e[0]||{}).value})},userInfoCall:function(e){if(e&&e.data&&e.data.token)this.errorMsg=e.data.token,localStorage.mmToken=e.data.token,location.href="#";else{try{this.errorMsg=JSON.stringify(e)}catch(a){alert(a)}location.href="#"}},check:function(){var e=this;e.getSearch("grouponId")&&(console.log(e.getSearch("grouponId")),e.param.grouponId=e.getSearch("grouponId")),e.valiForm(function(){e.pay&&e.historyOrder[e.param.phone]?mui("#select-pay").popover("show"):(localStorage.groupParam=JSON.stringify(e.param),localStorage.addressText=e.addressText,e.httpAjax({url:"/h5/grouponcheckout/placeOrder",param:e.param,complete:function(a){3==a.code&&e.popup({content:a.msg,type:"alert",autoClose:!1,ok:function(){e.isApp()?(localStorage.removeItem("mmToken"),e.app_userinfo(),setTimeout(function(){localStorage.mmToken?e.go(e.page+"/payment/my_order.html?orderId="+a.joinedOrderId):e.app_login()},500)):e.go(e.page+"/payment/my_order.html?orderId="+a.joinedOrderId)}}),4==a.code&&e.popup({content:a.msg,type:"alert",autoClose:!1,ok:function(){e.go(e.page+"/special/group/list.html")}})},success:function(a){if(1==a.code&&a.data.order){mui("#select-pay").popover("show");var o=a.data.order.increment_id;e.pay.orderId=o,e.historyOrder[e.param.phone]=o,e.isWeixin()?(e.pay.wx=!0,e.pay.ali=!1,e.pay.wxOk=function(){location.href="/m/special/group/success.html?orderId="+o}):(e.pay.wx=!1,e.pay.ali=!0,e.pay.aliUrl=e.port+"/h5/payment/grouponPayment?orderId="+o)}}}))})}},ready:function(){this.$refs.loading.show=!1},created:function(){if(!this.isWeixin()||this.getOpenId()||this.getSearch("code")||this.wxPay(),this.param.productId=this.getSearch("productId"),this.param.productId?(this.param.productId=this.param.productId.replace(/_.*/,""),sessionStorage.productId=this.param.productId):this.param.productId=sessionStorage.productId,this.getSearch("grouponId"))this.param.grouponId=this.getSearch("grouponId");else if(localStorage.groupParam){var e=JSON.parse(localStorage.groupParam);delete e.grouponId,localStorage.groupParam=JSON.stringify(e),localStorage.removeItem("grouponId")}localStorage.groupParam&&(this.param=JSON.parse(localStorage.groupParam)),localStorage.addressText&&(this.addressText=localStorage.addressText)}})});