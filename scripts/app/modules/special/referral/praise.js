define("/modules/special/referral/praise",["require","exports","module","/modules/vue/vue","/modules/vue/vue-validate","/modules/vue/vue-validator","/modules/vue/vue-common"],function(e){var r=e("/modules/vue/vue"),t=e("/modules/vue/vue-validate");r.use(e("/modules/vue/vue-validator"));var o=e("/modules/vue/vue-common");vue=new r({mixins:[o,t],el:"html",data:{title:"",init:!1,rule:!1,coupon:!1,showDow:!1,showTime:{show:!1,time:60},ABTest:"",CustomerId:"",param:{phone:"",authCode:""},Property:{},referralInfoData:{},desc:"",receive:!0,showReceive:!1,fail:!1,register:!1,showPhone:!1,inviteId:"",showGetBtn:!0,reviewInfo:null,productInfo:null,reviewId:null},methods:{couponF:function(){var e=this;e.coupon=!e.coupon,e.coupon&&(_hmt.push(["_trackEvent","referral_comment领券页面","领取"]),_maq.push(["_trackEvent","referral_comment_get",e.Property]))},ruleF:function(e){e.preventDefault(),this.rule=!this.rule},closeMask:function(e){e.preventDefault(),this.rule=!1,this.coupon=!1},trim:function(e){return e.replace(/\s/g," ")},getAuth:function(){var e=this,r=/^1[34578]{1}\d{9}$/,t=e.param.phone;if(0==t.search(r)&&11==t.length){e.showTime.show=!0;var o=setInterval(function(){e.showTime.time--,0==e.showTime.time&&(clearInterval(o),e.showTime.show=!1,e.showTime.time=60)},1e3);e.httpAjax({url:"/h5/sms/getAuth",param:{userName:e.param.phone},success:function(r){e.popup({content:r.msg})},alert:"false",complete:function(r){"0"==r.code&&(e.popup("您的手机号已在我们网站注册, 请联系客服"==r.msg?{content:"您的手机号已在我们网站注册，本券仅新用户可领哦",type:"alert",autoClose:!1}:"不是手机号码"==r.msg?{content:"手机号格式有误",type:"alert",autoClose:!1}:{content:r.msg,type:"alert",autoClose:!1}),clearInterval(o),e.showTime.show=!1,e.showTime.time=60)}})}else e.popup({content:"请输入11位正确的手机号码",time:2e3})},getCoupon:function(){var e=this;e.valiForm(function(){e.showGetBtn=!1,_maq.push(["_trackEvent","referral_comment_receive",e.Property]),e.httpAjax({url:"/h5/referral/getReferralCouponByPhone",type:"POST",param:{userName:e.param.phone,authCode:e.param.authCode,inviteId:e.inviteId,openId:e.openId,channel:"referral_comment",source:9},success:function(r){if(r.code="1"){var t={};t.receive="receive",t.userPhone=e.param.phone,t.reviewId=e.reviewId,localStorage[e.inviteId]=JSON.stringify(t),e.coupon=!e.coupon,e.showPhone=!0,e.fail=!1,_hmt.push(["_trackEvent","referral_comment领券页面","referral注册成功"]),_maq.push(["_trackEvent","referral_comment_success",e.Property])}e.showGetBtn=!0},complete:function(r){if("亲，您已注册，不符合领券条件"==r.msg){var t={};t.register="register",localStorage[e.inviteId]=JSON.stringify(t),e.showReceive=!1,e.register=!0,e.coupon=!e.coupon,e.fail=!1}else e.showGetBtn=!0},error:function(){e.coupon=!1,e.rule=!1,e.showReceive=!1,e.register=!1,e.init=!0,e.fail=!0,e.$refs.loading.show=!1}})})},showDowF:function(){var e=this;e.showDow=!1},chosePage:function(){var e=this;e.page=parseInt(10*Math.random())>4?"A":"B"},pi:function(e){return e?parseInt(e):0},come:function(){var e=this;e.showDow=!0,e.httpAjax({url:"/h5/referral/referralInfo",param:{inviteId:e.inviteId,openId:e.openId,reviewId:e.reviewId},success:function(r){e.showReceive=!0,e.referralInfoData=r,"receive"==e.referralInfoData.receive?(e.showReceive=!0,e.receive=!1,e.showPhone=!0,e.param.phone=e.referralInfoData.userPhone):"register"==e.referralInfoData.register&&(e.register=!0),e.productInfo=r.data.productInfo,e.reviewInfo=r.data.reviewInfo,localStorage.ABTest?e.ABTest=localStorage.ABTest:(e.ABTest=parseInt(10*Math.random())>4?"A":"B",localStorage.ABTest=e.ABTest),e.Property={group:e.ABTest,CustomerId:e.getUser()&&e.getUser().userId||null},_maq.push(["_trackPageView","referral_comment_page",e.Property]),e.init=!0;var t={title:"宋仲基送你"+e.referralInfoData.data.couponAmount+"元MEMEBOX新人优惠券！",desc:"全球知名化妆品平台- 美美箱MEMEBOX电商入驻中国啦！送"+e.referralInfoData.data.couponAmount+"元优惠券，首次下单即可使用。超低价正品韩妆等着你！还有机会和宋欧巴亲密接触哦！",link:location.href,imgUrl:location.origin+"/images/app/special/song.jpg"};e.set_share(t),e.desc=r.data.desc&&r.data.desc.split("\n")}})}},ready:function(){var e=this;e.$refs.loading.show=!1},created:function(){var e=this;e.reviewId=e.getSearch("reviewId"),e.inviteId=e.getSearch("inviteId"),e.isWeixin()?e.getWxOpenId(function(){e.come()}):e.come()}})});