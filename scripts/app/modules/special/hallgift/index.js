define("/modules/special/hallgift/index",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common"],function(t){{var e=t("/modules/vue/vue"),i=t("/modules/vue/vue-common");new e({mixins:[i],el:"html",data:{init:!1,dataProductList:[],showResult:"",orderTotal:null,move:{mask:!1,box:!1,disable:!1},paramObj:{order:"",filter:"",warehouse:"",pageIndex:"",pageSize:"",sku:"",category_ids:""},search:"",extra:{title:"",tips:"",amount:"",margin:"",limit:"",level:"",type:""},addExProList:[],hallGiftList:"",activityHallGift:{level:"",list:""},activity_id:"",changeBuyList:"",changeBuyPro:{},currentLength:0},methods:{checkExProQty:function(){return document.querySelectorAll('input[type="checkbox"]:checked').length==this.extra.limit?!1:!0},initMui:function(){function t(){var t=setTimeout(function(){t=null,mui("#pullrefresh").pullRefresh().endPullupToRefresh(),e.paramObj.pageIndex*e.paramObj.pageSize>=e.orderTotal?(e.popup({content:"没有更多商品了",time:1e3,autoClose:!0}),mui("#pullrefresh").pullRefresh().endPullupToRefresh(!0)):(e.paramObj.pageIndex++,e.getList())},0)}var e=this;mui.init({pullRefresh:{container:"#pullrefresh",up:{contentrefresh:"正在加载...",contentnomore:"",callback:t}}})},bindleChangeSortType:function(t){var e=this;e.paramObj.pageIndex=1,e.dataProductList=[],t||(t=4!=e.paramObj.order&&3!=e.paramObj.order?3:12/e.paramObj.order),e.paramObj.order=t,mui("#pullrefresh").pullRefresh().scrollTo(0,0,100),mui("#pullrefresh").pullRefresh().refresh(!0),e.getList()},checkSortType:function(){return 1==arguments.length?this.paramObj.order==arguments[0]&&"sort-title-active":2==arguments.length?(arguments[0]==this.paramObj.order||arguments[1]==this.paramObj.order)&&"sort-title-active":void 0},changeHallList:function(t,e){this.activityHallGift.list=this.hallGiftList.products[t].products,this.activityHallGift.level=e,this.currentLength=0},showChangePro:function(){var t=setTimeout(function(){t=null},1);this.move.mask=!0,this.move.box=!0},hideChangePro:function(){this.move.mask=!1,this.move.box=!1},getList:function(t){var e=this;e.httpAjax({url:"/global/search",domain:e.searchDomain,param:e.paramObj,success:function(i){e.showResult=!0,e.orderTotal=i.orderTotal,"function"==typeof t&&t(),mui("#pullrefresh").pullRefresh().refresh(!0),e.dataProductList=e.dataProductList.concat(i.data),e.init=!0;var r=setTimeout(function(){r=null,e.initEcho()},10)}})},getChangeBuyList:function(){var t=this;t.httpAjax({url:"/h5/cart/hallGiftList",param:{activity_id:t.activity_id,condition:t.extra.level},success:function(e){t.hallGiftList=e.data;for(var i=0,r=t.hallGiftList.products.length;r>i;i++)if(t.extra.level==t.hallGiftList.products[i].condition){t.activityHallGift.list=t.hallGiftList.products[i].products;break}}})},addCart:function(){var t=this,e=document.querySelectorAll('input[type="checkbox"]:checked');t.addExProList=[];for(var i=0,r=e.length;r>i;i++){{var a=e[i].parentNode.parentNode.querySelector(".activity");e[i].parentNode.parentNode.querySelector(".pro-options")}t.addExProList[i]={},t.addExProList[i].product_id=e[i].getAttribute("id"),a&&(t.addExProList[i].optionKey=a.getAttribute("key"),t.addExProList[i].optionValue=a.getAttribute("value"))}console.log(t.addExProList),t.httpAjax({url:"/h5/cart/addHallGift",param:{products:JSON.stringify(t.addExProList),activity_id:t.activity_id,warehouse:t.hallGiftList.warehouse},success:function(t){console.log(t),location.href="/m/cart/cart.html"}})},onlyOne:function(){var t=document.querySelector(".activity"),e=document.querySelectorAll('input[type="checkbox"]:checked');t&&(t.className=t.className.replace("activity",""));for(var i=0,r=e.length;r>i;i++)e[i].checked=!1;this.currentLength=1},choiceOption:function(t){var e=t.target.parentNode.querySelector(".activity"),i=t.target.parentNode.parentNode.parentNode.querySelector("input[type='checkbox']");return 0!=this.extra.margin?!1:this.checkExProQty()&&0==this.extra.margin||1==this.extra.limit||e?(1==this.extra.limit?this.onlyOne():this.currentLength++,e&&(e.className=e.className.replace("activity","")),t.target.className+=" activity",void(i.checked||(i.checked=!0))):!1},choicePro:function(t){var e=t.target;if(this.checkExProQty(),0!=this.extra.margin)return!1;"input"!==e.nodeName.toLocaleLowerCase()&&(e=e.childNodes);var i=e.parentNode.parentNode;e.checked?(1==this.extra.limit?(this.onlyOne(),t.target.checked=!0):this.currentLength++,!i.querySelector("span.activity")&&i.querySelector(".abled")&&(i.querySelector(".abled").className+=" activity")):(i.querySelector("span.activity")&&(i.querySelector("span.activity").className=i.querySelector("span.activity").className.replace("activity","")),this.currentLength--)},goCart:function(){location.href="/m/cart/cart.html"}},ready:function(){this.init=!0;for(var t in this.paramObj)this.paramObj[t]=this.getSearch(t),this.paramObj[t]||delete this.paramObj[t];for(var t in this.extra)this.extra[t]=this.getSearch(t);0==this.extra.margin?this.showChangePro():this.move.disable=!0,this.activityHallGift.level=this.extra.level,this.setTitle(this.extra.title),this.activity_id=this.getSearch("activity_id"),this.getList(function(){this.initMui()}.call(this)),this.getChangeBuyList()},created:function(){},watch:{currentLength:function(t){var e=document.querySelectorAll('input[type="checkbox"]');if(t==this.extra.limit&&1!=this.extra.limit)for(var i=0,r=e.length;r>i;i++)!e[i].checked&&(e[i].disabled=!0);else if(document.querySelector('input[type="checkbox"]:disabled'))for(var i=0,r=e.length;r>i;i++)e[i].disabled=!1}}})}});