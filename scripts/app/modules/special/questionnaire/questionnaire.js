define("/modules/special/questionnaire/questionnaire",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common","/modules/app/app"],function(e){var t,s=e("/modules/vue/vue"),n=e("/modules/vue/vue-common"),i=e("/modules/app/app");try{t=JSON.parse(localStorage.cacheSubmitObj)}catch(o){}window.vue=new s({mixins:[n,i],el:"html",data:{orderListStyle:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],preview:null,questionsData:null,isNotCollapse:[],isQuestionAnswered:[],submitObj:{survey_id:"",answers:[]},answersText:[],questionType:[null,"单选","多选","填空"],isRequired:["选填","必填"],isAnswerComplete:!1,hasSubmitted:!1,hasReward:!1,msg:""},computed:{},filters:{trim:function(e){return e.trim()}},methods:{syncCss:function(){this.$nextTick(function(){window.getComputedStyle(document.querySelector("body"),null).getPropertyValue("transform")})},getUserInfo:function(){var e=this;e.isApp()?e.processAppUserData():e.isLogin()&&!e.getQuestions()||e.loginFunc()},processAppUserData:function(){var e=this;localStorage.removeItem("mmToken"),e.app_userinfo()},getQuestions:function(){var e=this;e.preview||e.httpAjax({url:"/h5/survey/detail",param:{survey_id:e.getSearch("survey_id")},goLogin:!1,alert:!0,success:function(t){1==t.code&&e.setQuestionsDataAndSubmitObj(t.data)},complete:function(t){1!=t.code&&mui.alert(t.msg,function(){"0"==t.code&&e.app_back(),"2"==t.code&&e.loginFunc()})}})},setQuestionsDataAndSubmitObj:function(e){var s=this;s.hasReward=e.rule_id&&"0"!=e.rule_id||e.point_amount&&"0"!=e.point_amount,s.questionsData=e,s.submitObj.survey_id=e.survey_id,e.questions.forEach(function(e){s.submitObj.answers.push({question_id:e.question_id,is_required:e.is_required,answer:"2"==e.type?[]:""})}),s.answersText.length=s.isQuestionAnswered.length=e.questions.length;for(var n=0;n<s.answersText.length;n++)s.answersText[n]="";s.$nextTick(function(){[].slice.call(document.querySelectorAll(".question-option-container"),0).forEach(function(e){e.style.height=e.scrollHeight+"px"})}),document.querySelector("html").style.height=window.innerHeight+"px",s.isCacheNeeded(t),s.$nextTick(function(){s.setElementNotCollapse(0,!0)})},setQuestionAnswered:function(e,t){var s=this;if("3"==s.questionsData.questions[e].type)s.answersText.splice(e,1,s.submitObj.answers[e].answer);else{var n=[].concat(s.submitObj.answers[e].answer),i=s.questionsData.questions[e].options.reduce(function(e,t){return n.some(function(s){return t.option_id===s?(e.push(t.value),!0):void 0}),e},[]);s.answersText.splice(e,1,i.toString().split(",").join(" / "))}return t===!0?void s.isQuestionAnswered.splice(e,1,t):void(!s.submitObj.answers[e].answer.length&&s.isQuestionAnswered.splice(e,1,!1))},fixAndroidBug:function(e){mui(".mui-android-4-3").length&&e.stopPropagation()},foreverChecked:function(e){e.target.checked=!0},loginFunc:function(){var e=this;localStorage.ref=location.href,e.isApp()?setTimeout(function(){e.app_login()},100):e.go("/m/account/login.html")},userInfoCall:function(e){var t=this;e&&e.data&&e.data.token&&(this.errorMsg=e.data.token,localStorage.mmToken=e.data.token),localStorage.mmToken?t.getQuestions():setTimeout(function(){t.app_login()},100)},processAppUserData:function(){var e=this;localStorage.removeItem("mmToken"),e.app_userinfo()},setElementNotCollapse:function(e,t){var s=this;s.$nextTick(function(){s.isNotCollapse.splice(e,1,t),!t&&s.isNotCollapse.length>e+1&&s.$nextTick(function(){s.isNotCollapse.splice(e+1,1,!t)}),"3"==s.questionsData.questions[e].type&&(s.submitObj.answers[e].answer=s.submitObj.answers[e].answer.trim()),s.submitObj.answers.forEach(function(e,t){e.answer.length&&s.setQuestionAnswered(t,!0)})})},inputAnswer:function(e){var t=this;t.submitObj.answers.some(function(t){return t.question_id==e.target.getAttribute("data-index")?(t.answer=e.target.value,!0):void 0})},chooseReady:function(e){var t=this;return t.submitObj.answers[e].answer.length||"1"!=t.submitObj.answers[e].is_required?void t.setElementNotCollapse(e,!1):void mui.alert("请先填写题目哦！")},toggleCollapse:function(e){var t=this,s=new Array(t.questionsData.questions.length),n=t.isNotCollapse[e];t.isNotCollapse=s,t.setElementNotCollapse(e,!n)},goToUserCenter:function(){window.appsdk.global.toUserCenter()},filterSubmitObj:function(e){var t=e.answers.filter(function(e){return 0!==e.answer.length||"1"==e.is_required?e:void 0}),s=JSON.parse(JSON.stringify(e));return s.answers=t,s},isCacheNeeded:function(e){var t=this;e&&t.$nextTick(function(){try{var s=t.filterSubmitObj(e);s.survey_id==t.submitObj.survey_id&&t.submitObj.answers.forEach(function(e){s.answers.forEach(function(t,n){t.question_id==e.question_id&&(s.answers.splice(n,1),e.answer=t.answer)})})}catch(n){}})},submit:function(){var e=this;setTimeout(function(){if(e.isAnswerComplete&&!e.preview){var t=e.filterSubmitObj(e.submitObj);e.httpAjax({url:"/h5/survey/saveAnswer",type:"post",alert:!0,param:{data:JSON.stringify(t)},success:function(t){1==t.code&&(e.hasSubmitted=!0,localStorage.removeItem("cacheSubmitObj"),e.syncCss(),"1"==t.data.reward?e.msg=t.msg:"0"==t.data.reward&&e.hasReward?e.msg="非常感谢您的支持，答卷奖励数量有限，已发放完毕，下次可以早点来哦 ~":"0"!=t.data.reward||e.hasReward||(e.msg="非常感谢您的支持，我们会继续努力为您提供更加贴心的服务 ~"))},complete:function(t){1!=t.code&&mui.alert(t.msg,function(){"0"==t.code&&e.app_back(),"2"==t.code&&e.loginFunc(),"3"==t.code&&location.reload()})}})}else e.preview?(e.hasSubmitted=!0,e.msg="preview msg"):mui.alert("您还有必答题没有答完哦！")},50)}},ready:function(){},watch:{questionsData:function(){var e=this;e.isNotCollapse.length=e.questionsData.questions.length},answersText:function(){var e=this;e.$nextTick(function(){e.isAnswerComplete=!e.submitObj.answers.some(function(e){return 0===e.answer.length&&"1"==e.is_required}),e.isAnswerComplete&&e.syncCss()})},submitObj:{handler:function(){var e=this;localStorage.cacheSubmitObj=JSON.stringify(e.submitObj)},deep:!0}},created:function(){var e=this;if(e.preview=e.getSearch("preview"),e.preview)try{e.setQuestionsDataAndSubmitObj(JSON.parse(decodeURIComponent(location.hash.substring(1))))}catch(t){alert("请先添加题目再进行预览")}else e.getUserInfo()}})});