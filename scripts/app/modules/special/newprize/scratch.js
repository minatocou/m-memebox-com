define("/modules/special/newprize/scratch",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common","/modules/app/app","/modules/plugins/card"],function(t){var e=t("/modules/vue/vue"),a=t("/modules/vue/vue-common"),i=t("/modules/app/app"),r=t("/modules/plugins/card");vue=new e({mixins:[a,i],el:"html",data:{pageData:null,init:!0,showLogin:!1,showAddress:!1,addressText:null,userInfo:{name:null,phone:null,address:null,province:null,city:null,district:null,street:null},showTime:{time:"获取验证码",show:""},param:{phone:"",authCode:""},activity_id:null,type:2,showPrize:!1,prize:!1,is_real:!1,wxShareShow:!1,showBi:!0,prize_img:null,orderId:null,commonShare:!0},methods:{appShareCall:function(){},userInfoCall:function(t){if(t&&t.data&&t.data.token)this.errorMsg=t.data.token,localStorage.mmToken=t.data.token,this.initPage();else{try{this.errorMsg=JSON.stringify(t)}catch(e){alert(e)}this.initPage()}},login:function(){var t=this,e=20;if(this.pageData.customer){if(!this.pageData.customer.draw_status)return!1;t.start()}else localStorage.source=e,this.isApp()?this.app_login({channel:e}):this.h5_login(null,e)},initCard:function(){this.showBi=!1,r.case({ratio:.6,coverImg:"/images/app/special/newprize/include/g1.png?t=20174271851"},function(){this.clearCover()})},initPage:function(){var t=this;t.httpAjax({url:"/h5/rafflev2/view",param:{activityId:t.activity_id,type:t.type},success:function(e){if(1==e.code){t.showPrize=!0,t.pageData=e.data,t.setTitle(t.pageData.raffle.info.name),t.app_setShare(t.getShareData());var a=t.pageData.raffle.info.description&&t.pageData.raffle.info.description.replace(/\n/g,"/n").split("/n"),i="";a.forEach(function(t){i+="<div>"+t+"</div>"}),t.pageData.raffle.info.description=i,document.body.addEventListener("touchmove",function(t){t.preventDefault()},!1)}}})},hideMask:function(){this.showAddress=!1,this.showLogin=!1},trackPv:function(){_maq.push(["_trackEvent","Scratch_page",{Platform:this.getPlatform()}])},raffle:function(){var t=this;_maq.push(["_trackEvent","Scratch_check",{Platform:this.getPlatform()}]);var e={activityId:t.activity_id,type:t.type};t.orderId&&(e.orderId=t.orderId),t.httpAjax({url:"/h5/rafflev2/draw",type:"POST",param:e,success:function(e){if(1==e.code){if(_maq.push(["_trackEvent","scratch_click_successful",{scratchRaffle:"scratch"}]),t.prize=e.msg,t.is_real=e.data.is_real,t.pageData.raffle.myPrize=e.data.raffle.myPrize,e.data.prid){var a=e.data.raffle.reward.filter(function(t){return t.prize_id===e.data.prid});t.prize_img=a[0].prize_img}t.pageData.customer=e.data.customer,t.initCard()}}})},getShareData:function(){var t=this;return{title:t.pageData.raffle.info.name,text:"全球知名化妆品平台- 美美箱MEMEBOX电商入驻中国啦!",url:location.href,image:"http://m.cn.memebox.com/images/app/favicon.png",close:1}},raffleShare:function(t){var e=this;e.httpAjax({url:"/h5/rafflev2/share",type:"POST",showLoading:!1,param:{activityId:e.activity_id},success:function(a){if(200==a.code)if(e.isApp()){_maq.push(["_trackEvent","scratch_share",{scratch:"share"}]);var i=setInterval(function(){e.pageData.customer=a.data.customer,clearInterval(i),location.reload()},6e3)}else 1==t.code&&location.reload()}})},closeWxShare:function(){this.wxShareShow=!1},start:function(){var t=this;if(0==this.pageData.raffle.info.status||2==this.pageData.raffle.info.status)return!1;if(!this.pageData.customer)return this.login(),!1;if(0==this.pageData.customer.draw_status)return this.popup(t.isApp()?{content:"你没有刮奖资格"}:{title:" ",content:"刮奖次数已用完",type:"confirm",btn:['<span style="color:#ccc">关闭</span>',"下载app"],ok:function(){t.getAppUrl()}}),!1;if(1==this.pageData.customer.draw_status){if(this.pageData.customer.can_draw)return t.raffle(),!0;this.popup(this.isApp()?{content:"刮奖次数已用完"}:{title:" ",content:"刮奖次数已用完",type:"confirm",btn:['<span style="color:#ccc">关闭</span>',"下载app"],ok:function(){t.getAppUrl()}})}else t.raffle()}},ready:function(){this.init=!0,this.$refs.loading.show=!1},created:function(){var t=this;t.activity_id=t.getSearch("activityId"),t.type=t.getSearch("type"),t.orderId=t.getSearch("orderId"),t.trackPv(),t.isApp()?(localStorage.removeItem("mmToken"),t.app_userinfo(),setTimeout(function(){localStorage.mmToken||t.initPage()},500)):t.initPage()}})});