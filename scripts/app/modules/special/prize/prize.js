define("/modules/special/prize/prize",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common","/modules/app/app"],function(t){var e=t("/modules/vue/vue"),i=t("/modules/vue/vue-common"),r=t("/modules/app/app"),a=function(){function t(t){var e=this;setTimeout(function(){e.btnTextIndex=1,e.hasPrized=!0,e.prizeTip="您抽中了",t.target.disabled=!1,e.disabledFlag=!1,e.showUserPrize.call(e)},1e3)}var e=0,i="",r="",a="",n={prizeComplete:!1},o={touchstart:function(t){if(t.target.disabled)return void(this.disabledFlag=!0);"number"==typeof a&&clearInterval(a);var i=this;e=new Date,r=setTimeout(function(){i.animationOnce=!1,t.target.disabled=!0,i.$nextTick(function(){i.validateLogin()&&i.startPrize(n)})},300)},touchend:function(o){if(!this.disabledFlag){var s=this;clearTimeout(r),i=new Date,s.validateLogin()&&(300>i-e?mui.alert("请您按久一点哦！"):n.prizeComplete?t.call(s,o):n.prizeComplete||(a=setInterval(function(){n.prizeComplete&&(t.call(s,o),clearInterval(a))},1e3),setTimeout(function(){n.prizeComplete||(clearInterval(a),t.call(s,o),mui.alert("抽奖好像出错了，您可以刷新页面试试哦！",function(){location.reload()}))},1e4)))}}};return function(t){var e=this;e.prizeHasDone()?"touchend"===t.type&&e.prizeShare():o[t.type].call(e,t)}}(),n=requestAnimationFrame||webkitRequestAnimationFrame;window.vue=new e({mixins:[i,r],el:"html",data:{userData:{nickname:"登陆后即可抽奖"},disabledFlag:!1,prizeDetail:"？？？？？",stateClassList:["state-one","state-two","state-three","state-four","state-five"],stateClassIndex:0,btnTextList:["长按抽奖","分享结果"],btnTextIndex:"",prizeTip:"请抽奖",INTERVAL:100,prizedUserList:[],prizeList:[""],animation:!1,hasPrized:!1,transform:0,description:"&nbsp;",wxShareShow:!1,userScrollable:!0,startJumpTimer:"",touchendTimer:"",animationOnce:!1,animationDuration:"",start:!0},computed:{styleObject:function(){var t=this;return{transform:"rotateX(-"+t.transform+"deg)","animation-duration":this.animationDuration/1e3+"s"}},stateClass:function(){var t=this;return t.stateClassList[t.stateClassIndex]},btnText:function(){var t=this;return t.btnTextList[t.btnTextIndex]}},methods:{getUserInfo:function(){var t=this;t.isApp()?t.processAppUserData():t.getUserData()},getUserData:function(){var t=this;t.httpAjax({url:"/h5/raffle/view",success:function(e){1==e.code?(Object.keys(e.data.customer).length&&(t.userData=e.data.customer),t.userData.is_draw&&(t.btnTextIndex=1,t.prizeTip="您抽中了",t.$nextTick(function(){t.showUserPrize(!0)}))):mui.alert(e.msg)}})},processAppUserData:function(){var t=this;localStorage.removeItem("mmToken"),t.app_userinfo()},userInfoCall:function(t){var e=this;t&&t.data&&t.data.token&&(this.errorMsg=t.data.token,localStorage.mmToken=t.data.token),localStorage.mmToken?e.getUserData():setTimeout(function(){e.app_login()},100)},loginOrPrize:function(){var t=this;t.validateLogin(t.prizeActive)},startPrize:function(t){var e=this;e.animation=!0;var i=mui(".animation-target")[0];i.style.animationDuration=i.style.webkitAnimationDuration=null,window.getComputedStyle(i,null).getPropertyValue("-webkit-animation-duration"),e.trackClick(),e.httpAjax({url:"/h5/raffle/draw",success:function(i){"1"==i.code?e.completePrizeCallback(t):mui.alert(i.msg)}})},completePrizeCallback:function(t){t.prizeComplete=!0;var e=this;e.httpAjax({url:"/h5/raffle/view",success:function(t){1==t.code?Object.keys(t.data.customer).length&&(e.userData=t.data.customer):mui.alert(t.msg)}})},getStateClassIndex:function(){return Math.round(3*Math.random()+1)},prizeActive:a,validateLogin:function(t){var e=this;if(e.start){var i=!0;if(e.isLogin())return"function"==typeof t&&(i=t()),i;localStorage.ref=location.pathname,e.isApp()?setTimeout(function(){e.app_login()},100):(localStorage.source="6",e.go("/m/account/login.html"))}},prizeHasDone:function(){return this.hasPrized},togglePageCell:function(){var t=document.documentElement,e=document.body,i=36.33;n(function r(){(t.scrollTop||e.scrollTop)<window.innerHeight&&((t.scrollTop||e.scrollTop)+i<window.innerHeight?(t.scrollTop+=i,e.scrollTop+=i,n(r)):(t.scrollTop=window.innerHeight,e.scrollTop=window.innerHeight))})},trackPv:function(){var t=this,e={isWeixin:"wechatprizepv",isApp:"APPprizepv",other:"otherprizepv"},i="";Object.keys(e).forEach(function(e,r){"function"==typeof t[r]&&t[r]()&&(i=e)}),i=i||e.other,_maq.push(["_trackEvent",i,{prizePv:i}])},trackClick:function(){var t=this,e={isWeixin:"wechatprizeclick",isApp:"APPprizeclick",other:"otherprizeclick"},i="";Object.keys(e).forEach(function(e,r){"function"==typeof t[r]&&t[r]()&&(i=e)}),i=i||e.other,_maq.push(["_trackEvent",i,{prizeShare:i}])},getShareData:function(){return{title:"我要蜜豆",text:"大家都来领蜜豆！",url:location.href,image:location.origin+"/images/app/special/prize/include/memebox.png"}},prizeShare:function(){this.isApp()?this.app_share(this.getShareData()):this.isWeixin()?this.wxShare():this.getAppUrl()},wxShare:function(){this.wxShareShow=!0},setPrizeListStyle:function(){var t=this,e=mui(".prize-info-show li");e.each(function(e,i){i.style.transform=i.style.webkitTransform="rotateX("+360*e/t.prizeList.length+"deg) translateZ("+.8*t.prizeList.length+"em)"}),t.animationDuration=2200*t.prizeList.length,!t.prizeHasDone()&&t.$nextTick(function(){t.animationOnce=!0})},showUserPrize:function(t){var e=this;e.animation=!1,e.animationOnce=!1;var i=e.prizeList.indexOf(e.userData.prize);if(-1===i)return void e.prizeList.splice(0,1,e.userData.prize);var r=360/e.prizeList.length*i;return t?void(e.transform=r):/mui-android-4-3/g.test(document.body.className)?void(mui(".prize-info-show")[0].innerHTML="<div>"+e.userData.prize+"</div>"):void e.$nextTick(function(){e.numberTo("transform",r)})},numberTo:function(t,e,i){var r=this,i=i||1e3,a=(e-r[t])/i*16.7;e-r[t]>0?n(function o(){r[t]<e&&(r[t]+a<e?(r[t]+=a,n(o)):r[t]=e)}):e-r[t]<0&&n(function s(){r[t]>e&&(r[t]+a>e?(r[t]+=a,n(s)):r[t]=e)})},closeWxShare:function(){this.wxShareShow=!1},scrollUserList:function(){var t=this,e=document.querySelector(".prize-user-list"),i=e.children[0].offsetHeight;t.lazyLoad(t.getImages(e,i),~~(e.scrollTop/i)),t.startJumpTimer=t.startJump(e,i)},startJump:function(t,e){var i=this;return setInterval(function(){var r=(~~(t.scrollTop/e)+1)*e,a=r-t.scrollTop;t.scrollTop+t.offsetHeight<t.scrollHeight-5&&n(function o(){t.scrollTop<r?(t.scrollTop+=a,n(o)):i.lazyLoad(i.getImages(t,e),~~(t.scrollTop/e))})},1e3)},listTouchStart:function(){clearInterval(this.startJumpTimer),clearTimeout(this.touchendTimer)},listTouchEnd:function(){var t=this,e=document.querySelector(".prize-user-list"),i=e.children[0].offsetHeight;t.touchendTimer=setTimeout(function(){t.startJumpTimer=t.startJump(e,i)},2e3)},getImages:function(t,e){var i=~~(t.scrollTop/e),r=[].slice.call(t.children,i,i+5),a=[];return r.forEach(function(t){a.push(t.querySelector(".user-info-avatar"))}),a},lazyLoad:function(t,e){var i=this;t.forEach(function(t){t.src||(t.src=i.prizedUserList[e].avatar||"/images/app/my/include/user-logo.png"),e++})},initPageData:function(t){var e=this;t.data.customer.is_draw?(e.hasPrized=!0,e.btnTextIndex=1):e.btnTextIndex=0,e.prizeList=t.data.raffle.prize_list,e.$nextTick(e.setPrizeListStyle),e.description=t.data.raffle.info.description.replace(/(\r\n)|(\n)/gm,"<br>"),e.prizedUserList=t.data.raffle.customer_list,e.prizedUserList.length&&e.$nextTick(e.scrollUserList)}},ready:function(){var t=this;t.set_share(t.getShareData()),t.app_setShare(t.getShareData())},created:function(){var t=this;t.trackPv(),t.httpAjax({url:"/h5/raffle/view",success:function(e){1==e.code?("0"===e.data.raffle.info.is_active.toString()&&(t.start=!1),t.start&&(t.initPageData(e),setTimeout(function(){t.getUserInfo()},0))):mui.alert(e.msg)}})}})});