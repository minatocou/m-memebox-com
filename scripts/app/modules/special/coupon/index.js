define("/modules/special/coupon/index",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common","/modules/vue/vue-validate","/modules/app/app"],function(e){var t=e("/modules/vue/vue"),o=e("/modules/vue/vue-common"),i=e("/modules/vue/vue-validate"),s=e("/modules/app/app");t.filter("pcc",function(e,t){return e.match("¥")?0==t?e.slice(t,1):parseInt(e.slice(t)):0==t?"":e.replace(".","")}),vue=new t({mixins:[o,i,s],el:"html",param:null,data:{title:"领券",init:!1,mobile:null,authCode:null,pageData:null,showM:!1,selectCoupon:null,showTime:{show:!1,time:60},data:{}},methods:{showDesc:function(e){e.stopPropagation(),e.target.classList.toggle("show")},sp:function(e,t){return 0==t?e.splice(t,1):e.splice(t)},initCoupon:function(){var e,t=this;t.mobile&&(e={phone:t.mobile}),t.httpAjax({url:"/h5/getcoupon/list",param:e,success:function(e){t.app_setShare({image:location.origin+"/images/app/favicon.png",url:location.href}),1==e.code?(t.init=!0,t.$refs.loading.show=!1,t.pageData=e.data,e.data.couponList||t.popup({content:"亲，这批券已被抢光，下个整点再来哦",type:"alert"})):t.popup({content:e.msg,type:"alert"})}})},getAuth:function(){var e=this,t=/^1[34578]{1}\d{9}$/,o=e.mobile;t.test(o)&&11==o.length?60==e.showTime.time&&(e.showTime.show=!0,e.showTime.time--,e.httpAjax({url:"/h5/sms/getAuth",param:{userName:o,type:"bindPhone"},success:function(t){e.popup({content:t.msg});var o=setInterval(function(){e.showTime.time--,0==e.showTime.time&&(clearInterval(o),e.showTime.show=!1,e.showTime.time=60)},1e3)},alert:"false",complete:function(t){"0"==t.code&&("您的手机号已在我们网站注册, 请联系客服"==t.msg?e.popup({content:"您的手机号已在我们网站注册，本券仅新用户可领哦",type:"alert",autoClose:!1}):"不是手机号码"==t.msg?e.popup({content:"手机号格式有误",type:"alert",autoClose:!1}):(e.popup({content:t.msg,type:"alert",autoClose:!1}),e.showTime.show=!1),e.showTime.time=60)}})):e.popup({content:"请输入11位正确的手机号码",time:2e3})},getText:function(e){var t="领取";return!e||0==e.is_active||e.uses_per_coupon&&e.times_used>=e.uses_per_coupon?t="已抢光":1==e.is_had_get&&(t="已领取"),this.isStart(e)||(t="未开始"),this.isEnd(e)||(t="已抢光"),t},isDisabled:function(e){return!e||1!=e.is_active||0!=e.is_had_get||e.uses_per_coupon&&e.times_used>=e.uses_per_coupon||!this.isStart(e)||!this.isEnd(e)?!0:!1},isStart:function(){return!0},isEnd:function(e){return"1"==e.is_dynamic?!0:e.serverTime<e.to_date?!0:!1},useCoupon:function(e){var t=this;if(e=e||t.selectCoupon,t.isApp())if(localStorage.mmToken){if(this.data.data){var o=this.data.data.customerId;console.log(this.getShareData(o))}}else this.app_login();if(t.isDisabled(e))t.popup({content:"已抢光",type:"alert"});else if(t.mobile&&t.authCode||localStorage.mmToken){var i={ruleId:e.rule_Id};t.mobile&&(i.phone=t.mobile),t.authCode&&(i.authCode=t.authCode),t.httpAjax({url:"/h5/getcoupon/bind",param:i,success:function(o){1==o.code&&(e.is_had_get=1,t.mobile&&(sessionStorage.userName=t.mobile),t.popup({content:o.msg})),4==o.code&&(e.is_had_get=1,t.popup({content:"已抢光",type:"alert"})),5==o.code&&(e.is_had_get=1,t.popup({content:"已领取",type:"alert"})),t.showM=!1},complete:function(e){1!=e.code&&5!=e.code&&(t.mobile=null,t.authCode=null,t.showM=!1)}})}else t.isApp()||(t.selectCoupon=e,t.showM=!0)},userInfoCall:function(e){if(e&&e.data&&e.data.token)this.errorMsg=e.data.token,localStorage.mmToken=e.data.token,this.initCoupon();else{try{this.errorMsg=JSON.stringify(e)}catch(t){alert(t)}this.initCoupon()}}},ready:function(){},created:function(){var e=this;e.mobile=e.getSearch("mobile")||e.getSearch("phone")&&e.dbase64(e.getSearch("phone"))||sessionStorage.userName,e.isApp()?(localStorage.removeItem("mmToken"),e.app_userinfo(),setTimeout(function(){localStorage.mmToken||e.initCoupon()},500)):e.initCoupon()}})});