define("/modules/special/flashsale/index",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common","/modules/app/app"],function(t){{var i=t("/modules/vue/vue"),e=t("/modules/vue/vue-common"),n=t("/modules/app/app");new i({mixins:[e,n],el:"html",data:{testData:null,groupList:null,show:!1,showList:!1,tab:{date:[],time:[]},countdownFlag:"",secKillTime:"",durationInfo:"",IS_active:"",serverTime:"",activeTime:[],activeIndex:null,swiper:[],list:"",ACTIVE_INDEX:[]},methods:{goDetail:function(t){var i={productId:t.productId,durationId:t.durationId,groupId:t.groupId,activityType:4,from:"h5list"};this.isApp()?this.app_product(i):location.href="/m/productDetails/productDetails.html?from=h5list&p="+t.productId+"&groupId="+t.groupId+"&durationId="+t.durationId+"&activityType=4"},changeActive:function(){var t=this;return t.serverTime<t.durationInfo.secKillStartTime?2:t.durationInfo.secKillStartTime<t.serverTime&&t.serverTime<t.durationInfo.secKillEndTime?3:t.durationInfo.secKillEndTime<t.serverTime?1:void 0},getServerTime:function(){var t,e=this,n=["","end","no-start","start"],a=["","已结束","未开始","活动中"];e.showList=!1,e.httpAjax({url:"/h5/seckill/getServiceTimeStamp",success:function(o){if(1==o.code){e.serverTime=o.data.nowTimeStamp,clearInterval(e.countdownFlag);var s=["","",function(){e.countdown(e.durationInfo.secKillStartTime,e.serverTime,function(){i.set(e.durationInfo,"class","start"),i.set(e.tab.time[e.activeIndex[0]][e.activeIndex[1]],1,"活动中"),e.changeTime(e.activeIndex[1]),e.countdown(e.durationInfo.secKillEndTime,e.serverTime,function(){location.reload()})})},function(){e.countdown(e.durationInfo.secKillEndTime,e.serverTime,function(){location.reload()})}];i.set(e.durationInfo,"is_active",e.changeActive()),t=e.durationInfo.is_active,"function"==typeof s[t]&&s[t](),i.set(e.durationInfo,"class",n[t]),i.set(e.tab.time[e.activeIndex[0]][e.activeIndex[1]],1,a[t]),i.set(e.durationInfo,"class",n[t]),e.showList=!0}}})},pageInit:function(){var t=this;t.httpAjax({url:"/h5/seckill/list",token:!1,success:function(i){t.groupList=i.data.groupList,t.formatList(t.groupList),t.activeTime=t.tab.time[t.activeIndex[0]],t.$nextTick(t.swiperInit),t.show=!0}})},changeTime:function(t){var i,e=this.groupList[this.activeIndex[0]].duration[t],n=this;this.activeIndex[1]=t,this.list=e.productList,this.changeDuration(e),this.activeTime=null,i=setTimeout(function(){n.activeTime=n.tab.time[n.activeIndex[0]],i=null},0)},changeDate:function(t){var i=this,e=this.groupList[t].duration[0];this.activeIndex[0]=t,this.activeIndex[1]=0,this.activeTime=i.tab.time[t],this.list=e.productList,this.changeDuration(e)},swiperInit:function(){var t=this;t.swiper[0]=new Swiper(".nav1",{slidesPerView:5,centeredSlides:!0,slideToClickedSlide:!0,initialSlide:t.activeIndex[0],onSlideChangeEnd:function(i){t.changeDate(i.activeIndex)}})},getStock:function(t){var i="",e=this;if(3!=e.IS_active)return!1;for(var n=0,a=t.length;a>n;n++)i+=","+t[n].productId;i=i.slice(1),e.httpAjax({domain:e.searchDomain,url:"/global/price",param:{productIds:i},success:function(i){for(var e=i.data,n=0,a=e.length;a>n;n++)t[n].seckillStock=1==e[n].stockStatus&&1==t[n].seckillStock?!0:!1}})},formatList:function(t){var e=0,n=t.length,a=this,o=["","已结束","未开始","活动中"],s=!1;for(e;n>e;e++){var r=t[e].duration.length;this.tab.date.push(a.getDate(t[e].date)),this.tab.time.push([]);for(var c=0;r>c;c++)this.tab.time[e].push([]),a.tab.time[e][c].push(a.getTime(t[e].duration[c].secKillStartTime)),3==t[e].duration[c].is_active&&(a.IS_active=3),(3==t[e].duration[c].is_active||2==t[e].duration[c].is_active&&null==a.activeIndex)&&(s=!0,a.activeIndex=[e,c],a.ACTIVE_INDEX[0]=e,a.ACTIVE_INDEX[1]=c,a.list=t[e].duration[c].productList,a.changeDuration(t[e].duration[c])),i.set(a.tab.time[e][c],1,o[t[e].duration[c].is_active])}s||(a.activeIndex=[0,0],a.ACTIVE_INDEX[0]=0,a.ACTIVE_INDEX[1]=0,a.list=t[0].duration[0].productList,a.changeDuration(t[0].duration[0])),a.getStock(a.list)},changeDuration:function(t){var i=this;this.durationInfo={},this.durationInfo.secKillEndTime=t.secKillEndTime,this.durationInfo.secKillStartTime=t.secKillStartTime,this.durationInfo.startTime=this.getTime(t.secKillStartTime),i.getServerTime(),console.log(99)},getTime:function(t){var i=new Date(t),e=i.getHours(),n=i.getMinutes();return(10>e?"0"+e:e)+":"+(10>n?"0"+n:n)},getDate:function(t){var i=t.match(/-(.+)/)[1];return i.replace("-","月")},countdown:function(t,i,e){function n(t){o.countdownFlag=setInterval(function(){t>=0?(a(t),t--):(clearInterval(o.countdownFlag),"function"==typeof e&&e())},1e3)}function a(t){function i(t){return 10>t?"0"+t:t}var e=parseInt(t/60/60/24,10),n=parseInt(t/60/60%24,10),a=parseInt(t/60%60,10),s=parseInt(t%60,10);o.secKillTime=(0!=e?e+":":"")+i(n)+":"+i(a)+":"+i(s)}var o=this;return t=(t-i)/1e3,0>=t?!1:void n(t)}},ready:function(){this.pageInit()},created:function(){_maq.push(["_trackPageView","flash_list_page",{}])}})}});