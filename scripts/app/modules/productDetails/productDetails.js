define("/modules/productDetails/productDetails",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common","/modules/app/app","/modules/my/countdown"],function(t){var e=t("/modules/vue/vue"),o=t("/modules/vue/vue-common"),a=t("/modules/app/app"),i=t("/modules/my/countdown");vue=new e({mixins:[o,a,i],el:"html",data:{title:"商品详情",init:!1,showProduct:"",number:"",optionImg:[],productData:{},grouponInfo:{},presaleInfo:{},flashSale:{},time:{},promotionInfo:{gift:null},activityInfo:null,qty:"",cartNumber:"",allDisable:!0,collection:null,showTaxMask:!1,ani:!1,can:!0,result:{day:"",hour:"",minute:"",second:""},_productData:"",discount:"",mbData:null,shippingInfo:"",commentData:null,bestCommentData:null,bestCommentLength:0,bigImg:null,pageIndex:1,pageSize:10,swiper:null,pid:null,headerCss:{"background-color":"rgba(255, 80, 115,0)"},iconBg:!0,showTitle:!1,imgTextBtn:!1,toTop:!1,text:"",scrollY:0,newComerPrice:null,isPb:"",canBuySta:1,currentBrandId:null,KEYNODE:0},methods:{presaleFormatTime:function(t){var e=this,o=e.formatDate(t);return o.year+"."+o.month+"."+o.day+" "+o.hour+":"+o.minute},getDiscount:function(t){var e=this,o=[e.productData.price/e.productData.originPrice,(e.grouponInfo&&e.grouponInfo.grouponPrice)/e.productData.originPrice,null,!e.newComerPrice||e.mbData&&"0"==e.mbData.isNewcomer||!e.newComerPrice?e.productData.price/e.productData.originPrice:e.newComerPrice/e.productData.originPrice],a=(10*o[t]).toFixed(1);return 10>a&&a>=.1?a+="折":a=!1,a},initMui:function(){function t(){setTimeout(function(){e.pageSize*e.pageIndex>=e.commentData.total?(e.popup({content:"没有更多评价了",time:1e3,autoClose:!0}),mui("#s-comment").pullRefresh().endPullupToRefresh(!0)):(e.pageIndex++,e.getComment(),mui("#s-comment").pullRefresh().endPullupToRefresh(!1),setTimeout(function(){e.swiper=new Swiper(".swiper-container",{slidesPerView:3,paginationClickable:!0,spaceBetween:10,freeMode:!0})},0))},0)}var e=this;mui.init({pullRefresh:{container:"#s-comment",up:{contentrefresh:"正在加载...",callback:t}}})},canBuyPro:function(){var t=!1,e=this,o=e.canBuySta;return"1"!=o?!1:(e.productData.options&&0!=e.productData.options.length?e.productData.isEnabled&&"1"==e.productData.isEnabled&&(t=e.productData.options.some(function(t){return"1"!=t.disabled&&0!=t.qty})):e.productData.bundleOptions&&e.productData.bundleOptions.length>0?e.productData.isEnabled&&"1"==e.productData.isEnabled&&(t=e.productData.bundleOptions.some(function(t){var e=t.options,o=!1;return e.some(function(t){"1"!=t.disabled&&0!=t.qty&&(o=!0)}),o})):t=!0,t)},goGroupDetail:function(t){location.href=t},checkFlashStatus:function(t){var e=["","flash-over","flash-not-start","flash-start"];return this.flashSale.secKillStatus&&this.flashSale.secKillStatus!=t&&(this.flashSale.secKillStatus=t),e[t]},getDetail:function(){var t=this,e={productId:t.productData.productId};t.getSearch("activityType")&&(e=t.getProParams()),t.httpAjax({url:"/h5/product/detail",param:e,success:function(e){var o=e.data;t.optionImg=[],t.productData=o,t.canBuySta=o.stockStatus,t.grouponInfo=o.grouponInfo,t.presaleInfo=o.presaleInfo,t.grouponInfo.grouponList=o.grouponInfo.grouponList,t.promotionInfo.gift=t.isEmptyObject(o.gift)?null:o.gift,t.activityInfo=t.isEmptyObject(o.activityInfo)?null:o.activityInfo,t.isPb=o.isPb,localStorage.activityType=t.productData.activityType;var a="#details";if("2"==t.productData.activityType&&(localStorage.source="7",a="#presale",_maq.push(["_trackPageView","presaleProductDetails",{}])),"1"==t.productData.activityType&&(a="#group"),4==t.productData.activityType)a="#flashsale",localStorage.source="11",t.flashSale=e.data.seckillInfo,_maq.push(["_trackPageView","flash_detail_page",{}]),t.countdown(t.flashSale.secKillStartTime/1e3,t.time,!1,function(){t.checkFlashStatus(3),0!=t.flashSale.nextSecKillLeftTime?t.countdown(t.flashSale.nextSecKillLeftTime/1e3,t.time,!1,function(){t.checkFlashStatus(1)}):t.checkFlashStatus(1)});else if("0"!=t.productData.activityType&&"3"!=t.productData.activityType){var i=t.productData.activityType,r=["","grouponInfo","presaleInfo"],n=(t[r[i]].endTime||t[r[i]].endDepositTime)-t[r[i]].serverTime;t.countdown(n,t.result,!0)}else if(("0"==t.productData.activityType||"3"==t.productData.activityType)&&t.activityInfo)if(t.activityInfo.serverTime<t.activityInfo.startTime&&t.activityInfo.startTime-t.activityInfo.serverTime<t.activityInfo.preStartTime){var n=t.activityInfo.startTime-t.activityInfo.serverTime;t.countdown(n,t.result,!0)}else if(t.activityInfo.serverTime>t.activityInfo.startTime&&"0"!=t.activityInfo.endTime){var n=t.activityInfo.endTime-t.activityInfo.serverTime;t.countdown(n,t.result,!0)}if(t.init=!0,t.setTitle(o.brandName+o.name),t.productData.shippingInfo=t.productData.shippingInfo&&t.productData.shippingInfo.replace(/\n/g,"/n").split("/n"),0==t.productData.hasOptions)t.number=1;else{for(var c=0;c<t.productData.options.length;c++)if("0"==t.productData.options[c].disabled){t.allDisable=!1;break}t.init=!0,t.isWished(),t.getCart()}if(t.productData.hasBundleOption>0)for(var s=t.productData.bundleOptions,u=0;u<s.length;u++)s[u].options.length&&t.optionImg.push(s[u].options[0].imgUrl);t.getPrice(),t.isWished(),t.getCart(),t.getComment(),t.getBestComment(),t.getPromotionInfo(),t.initView(a),t.initScroll();var l=t.productData.price;3==t.productData.activityType&&t.productData.newcomerInfo&&t.productData.newcomerInfo.newcomerPrice&&(t.newComerPrice=t.productData.newcomerInfo.newcomerPrice);var p="【MEMEBOX】"+t.productData.brandName+" "+t.productData.name+" "+l,d=t.productData.img[0],m={title:p,text:"我在MEMEBOX发现了一件不错的商品，快来看看吧！",url:location.href,image:d};t.set_share(m),t.discount=t.getDiscount(t.productData.activityType)}})},getPrice:function(){var t=this;t.httpAjax({url:"/global/price",domain:t.searchDomain,param:{productIds:t.pid},success:function(e){if(1==e.code){var o=e.data[0];for(var a in o)o[a]&&(t.productData[a]=o[a]);if(4==t.productData.activityType){var i=["","",!0,1==o.stockStatus&&parseInt(t.flashSale.secKillStockStatus)&&t.canBuyPro()];t.flashSale.secKillStockStatus=i[t.flashSale.secKillStatus]}}}})},getComment:function(){var t=this;t.httpAjax({param:{product_id:t.productData.productId,page:t.pageIndex,pageSize:t.pageSize},url:"/h5/comment/reviewList",async:!1,goLogin:!1,alert:"false",success:function(e){var o=e.data;1==e.code&&e.total&&0!=e.total&&(t.pageIndex>1?t.commentData.data=t.commentData.data.concat(o):t.commentData=e)}})},toComment:function(){var t=this;setTimeout(function(){t.swiper=new Swiper("#comment .swiper-container",{slidesPerView:3,paginationClickable:!0,spaceBetween:10,freeMode:!0})},0)},preview:function(t){var e=this;e.bigImg=t},closePre:function(){var t=this;t.bigImg=null},buy:function(t){t.preventDefault();var e=this;e.showProduct=1},cartAn:function(){var t=this;t.ani=!0,setTimeout(function(){t.ani=!1,t.can=!0},0)},close:function(t){t.preventDefault();var e=this;e.showProduct=""},getCart:function(){var t=this;t.httpAjax({url:"/h5/newcart/count",success:function(e){t.cartNumber=e.data.totalQty}})},goFlashOrder:function(){var t=this;t.productData.orderLimit=1,3==t.flashSale.secKillStatus&&1==t.flashSale.secKillStockStatus&&(_maq.push(["_trackEvent","flash_detail_buy",{}]),"0"!=t.productData.options.length?t.$refs.productdata.showSelectOption(t.flashSale.secKillPrice):location.href="/m/payment/flashsale_order.html?productId="+this.productData.productId+"&durationId="+this.flashSale.durationId+"&groupId="+this.flashSale.groupId)},presaleBuy:function(){var t=this;t.productData.addCart=!1,t.productData.orderLimit=t.presaleInfo.orderLimit,t.$refs.productdata.showSelectOption(t.presaleInfo.deposit)},grouponBuy:function(){var t=this;t.productData.addCart=!1,t.productData.orderLimit=t.grouponInfo.orderLimit,t.$refs.productdata.showSelectOption(t.grouponInfo.grouponPrice)},newcomerBuy:function(){var t=this;localStorage.mmToken?(t.productData.addCart=!1,t.productData.orderLimit=t.productData.newcomerInfo.orderLimit,t.$refs.productdata.showSelectOption(t.productData.newcomerInfo.newcomerPrice)):(localStorage.ref=location.href,t.isApp()?t.app_login({source:10}):t.h5_login(null,10))},addCart:function(){var t=this;if(t.productData.orderLimit=!1,"0"!=t.productData.options.length||0!=t.productData.bundleOptions.length)t.productData.addCart=!0,t.$refs.productdata.showSelectOption();else{var e="/h5/newcart/add?productId="+t.productData.productId;t.can=!1,t.httpAjax({url:e,showLoading:!0,success:function(){t.cartAn(),t.httpAjax({url:"/h5/newcart/count",showLoading:!0,success:function(e){t.cartNumber=e.data.totalQty,_hmt.push(["_trackEvent","add_cart","加入购物车"]),_maq.push(["_trackEvent","add_cart",{is_pb:t.isPb,brandId:t.currentBrandId,keynode_page:t.KEYNODE}]),t.isFromStockSMS()&&_maq.push(["_trackEvent","msg_arrival_notice-cart","通过到货通知加入购物车"])}})},complete:function(){t.can=!0}})}},isWished:function(){var t=this;t.httpAjax({url:"/h5/account/productwishlist",goLogin:!1,param:{productId:t.pid},success:function(e){1==e.code&&(t.collection=e.isWished)}})},useCollection:function(){var t=this;if(1==t.collection){var t=this;t.httpAjax({url:"/h5/account/removeFromWishlist",param:{productId:t.pid},success:function(e){t.collection=1==e.code?0:1,t.popup({content:e.msg})}})}else{var t=this;t.httpAjax({url:"/h5/account/addToWishlist",param:{productId:t.pid},success:function(e){t.collection=1==e.code?1:0,t.popup({content:e.msg})}})}t.collection=1==t.collection?0:1},takMask:function(t){t.preventDefault(),this.showTaxMask=!this.showTaxMask},toggleMBMasek:function(){var t=this;t.isFanliApp()?t.fanliMask():t.popup({content:t.mbData.rewardDesc,type:"alert",autoClose:!1})},fanliMask:function(){var t=this;t.popup({title:'<p style="margin-bottom: 20px;color:#333">下载APP，蜜豆赚不停！</p>',content:'<p style="margin-bottom: 0;font-size:12px;text-align: left;color:#333;line-height: 20px;">注:仅在Memebox网站和APP内下单才可返蜜豆，更多会员权限请登陆Memebox查看。</p>',type:"confirm",btn:['<span style="color:#ccc">知道啦</span>',"去下载"],titleClass:"mini",ok:function(){location.href="http://pkg-cn1001.memebox.com/android/other/automm.html#flw"}})},getMBReward:function(){var t=this;t.httpAjax({url:"/h5/memeclub/productExtra",showLoading:!0,param:{productId:t.productData.productId},goLogin:!1,success:function(e){t.mbData=e.data,localStorage.isNew=e.data.isNewcomer}})},userInfoCall:function(t){if(t&&t.data&&t.data.token)this.errorMsg=t.data.token,localStorage.mmToken=t.data.token,this.getDetail();else{try{this.errorMsg=JSON.stringify(t)}catch(e){alert(e)}this.getDetail()}},goCart:function(){location.href="../cart/cart.html"},choiceOption:function(){var t=this;t.canBuyPro()&&(4==t.productData.activityType?t.$refs.productdata.showSelectOption(t.flashSale.secKillPrice):t.$refs.productdata.showSelectOption(),t.productData.addCart=!0)},showPresaleRule:function(){var t=this,e="",o=[];o=t.presaleInfo.description&&t.presaleInfo.description.replace(/\n/g,"/n").split("/n"),o.forEach(function(t){e+='<p style="text-align: left">'+t+"</p>"}),t.popup({type:"confirm",title:"预售须知",content:e,btn:["关闭"]})},getPromotionInfo:function(){var t=this;setTimeout(function(){t.swiper=new Swiper(".promotions .swiper-container",{slidesPerView:2.3,paginationClickable:!0,spaceBetween:10,freeMode:!0,autoplayDisableOnInteraction:!1})},0)},toGiftDetail:function(t){location.href="productDetails.html?p="+t},viewPromotion:function(){var t=this;t.$refs.promotion.showPromotion()},getBestComment:function(){var t=this;t.httpAjax({url:"/h5/comment/excellentList?product_id="+t.productData.productId,async:!1,goLogin:!1,alert:"false",success:function(e){if(1==e.code){for(var o=0,a=0;a<e.data.length;a++)e.data[a].thumbList.length>0&&o++;t.bestCommentLength=o,t.bestCommentData=e,setTimeout(function(){t.swiper=new Swiper(".product-comment .swiper-container",{slidesPerView:"auto",paginationClickable:!0,spaceBetween:10,freeMode:!0})},500)}}})},initScroll:function(){var t,e=this;setTimeout(function(){var o=document.querySelector("#s-details"),a=mui("#s-details").scroll();o.addEventListener("scroll",function(){t=setTimeout(function(){e.scrollY=a.y,clearTimeout(t)},50)})},0)},changePosition:function(){var t=this;if(t.toTop)mui("#s-details").scroll().scrollTo(0,0,1e3),t.toTop=!1;else{var e=document.querySelector(".product-information"),o=e.offsetTop-44;mui("#s-details").scroll().scrollTo(0,-o,1e3),t.toTop=!0}},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},brandIdSta:function(t,e){var o=this,a=o.productData.brandName;return o.currentBrandId=e,1==t?"/m/brand/home.html?id="+e:"/m/search/search.html?searchInput="+encodeURIComponent(a)},enterBrand:function(){var t=this,e=t.productData.brandName,o=t.currentBrandId;_maq.push(o?["_trackEvent","product_detail_enter_brand_click",{brand_id:o,keynode_page:t.KEYNODE}]:["_trackEvent","product_detail_enter_brand_click",{brand_name:e,keynode_page:t.KEYNODE}])},isFromStockSMS:function(){return this.getSearch("type")&&"stock_notification"===this.getSearch("type").toLowerCase()},getProParams:function(){var t=this,e={4:function(){return{productId:t.pid,groupId:t.getSearch("groupId"),durationId:t.getSearch("durationId"),activityType:4}}};return e[t.getSearch("activityType")]()}},ready:function(){var t,e=this,o={productId:e.pid},a=["","H5首页","H5搜索页","H5品牌页"];t=sessionStorage.KEYNODE||0,e.KEYNODE=a[t]||"",e.getSearch("activityType")&&(o=e.getProParams()),e.isFromStockSMS()?e.getSearch("from")&&(o.from=e.getSearch("from")):"",this.$refs.tdl.url=window.appsdk.global.toAppProduct(o)},created:function(){var t=this;t.pid=t.getSearch("p")||location.hash.slice(1),t.productData.productId=t.pid,t.isFromStockSMS()&&_maq.push(["_trackEvent","msg_arrival_notice",{customer:t.getSearch("u"),msg:"收到到货通知短信并点击在浏览器打开"}]),t.isApp()?appsdk.global.product(t.pid):(t.getDetail(),t.getMBReward(),t.initMui(),_hmt.push(["_trackEvent","product_detail","显示详情页"]))},watch:{scrollY:function(t){var e=this,o=document.body.clientHeight,a=.6*o,i=0,r=t;if(r>=0)i=0,e.showTitle=!1,e.iconBg=!0,e.imgTextBtn=!1,e.$refs.tdl.showDow=!0;else if(0>r&&r>=-a)i=(-r/a).toFixed(2),e.showTitle=!0,e.iconBg=!1,e.imgTextBtn=!1,e.$refs.tdl.showDow=!1;else{i=1,e.showTitle=!0,e.iconBg=!1,e.imgTextBtn=!0;var n=document.querySelector(".product-information"),c=n.offsetTop-44;e.toTop=r>-c?!1:!0,e.$refs.tdl.showDow=!1}e.headerCss={"background-color":"rgba(255, 80, 115,"+i+")"}}}})});