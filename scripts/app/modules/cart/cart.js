define("/modules/cart/cart",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common"],function(t){{var e=t("/modules/vue/vue"),a=t("/modules/vue/vue-common");new e({mixins:[a],el:"#app",data:{title:"购物车",init:!1,config:{max:99,min:1},countChangeTimer:null,editOrFinish:!0,showBtn:!1,showTil:!0,preferences:"",cartData:null,selectOnePro:!1,proIdBox:{1:[],2:[],4:[],8:[]},changeActivityParam:{activity_id:null,product_id:null}},methods:{countNum:function(t,e,a){var n=a.target.parentNode.getElementsByTagName("input")[0],c=n.value,i=n.getAttribute("itemId"),o=this;"add"==e&&c<this.config.max&&c++,"reduce"==e&&c>this.config.min&&c--,o.countChangeTimer&&clearTimeout(o.countChangeTimer),o.countChangeTimer=setTimeout(function(){o.updateCart(i,c)},500)},updateCart:function(t,e){var a=this;a.httpAjax({url:"/h5/cart/update",param:{itemId:t,qty:e},success:function(t){1==t.code&&(a.cartData=t.data)}})},remove:function(t){var e=this;e.popup({type:"confirm",content:"确认删除？",ok:function(){e.httpAjax({url:"/h5/cart/delete",param:{itemIds:t},success:function(t){1==t.code&&(e.cartData=t.data)}})}})},checkedItem:function(t){var e=this,a=e.cartData.warehouses,n=t.target.checked,c=t.target.getAttribute("value"),i=[],o=1,r="";if(o=n?1:0,"all"==c){for(var s in a)console.log(a[s].id),e.getItemId(a[s].id),i=i.concat(e.proIdBox[a[s].id]);r=JSON.stringify(i)}else a[c]?(e.getItemId(a[c].id),r=JSON.stringify(e.proIdBox[a[c].id])):(i.push(c),r=JSON.stringify(i));e.httpAjax({url:"/h5/cart/mark",param:{itemId:r,mark:o},success:function(t){1==t.code?e.cartData=t.data:e.popup({content:t.msg})}})},checkout:function(){var t=this,e="../payment/order_order.html";t.selectOnePro&&(location.href=e)},getItemId:function(t){for(var e=this,a=e.cartData.warehouses.length,n=0;a>n;n++)e.cartData.warehouses[n].id==t&&e.cartData.warehouses[n].preferences.forEach(function(a){a.products.forEach(function(a){e.proIdBox[t].push(a.itemId)})})},delSelectPrd:function(){var t=this;t.popup(t.showClean?{content:"您还没有选择商品"}:{type:"confirm",content:"确认删除？",ok:function(){t.httpAjax({url:"/h5/cart/batchDel",success:function(e){1==e.code?t.cartData=e.data:t.popup({content:e.msg})}})}})},initCart:function(){var t=this;t.httpAjax({url:"/h5/cart/view",success:function(e){t.cartData=e.data,1==e.code?(t.init=!0,t.$nextTick(function(){mui.init(),t.cartData.warehouses&&(document.getElementsByClassName("kr-notice")[0].style.bottom=document.getElementsByClassName("total")[0].clientHeight+"px")})):t.popup({content:e.msg})}})},cleanUp:function(){var t=this,e=localStorage.mmToken;t.popup({type:"confirm",content:"是否清除失效商品？",ok:function(){t.httpAjax({url:"/h5/cart/cleanUp",param:{$customer_id:e},success:function(e){1==e.code?t.cartData=e.data:t.popup({content:e.msg})}})}})},editCart:function(){var t=this;this.showBtn?(t.showTil=!0,t.showBtn=!1,mui(".cart-edit")[0].innerHTML="编辑"):(t.showTil=!1,t.showBtn=!0,mui(".cart-edit")[0].innerHTML="完成")},choiceDiscount:function(t,e,a){var n=document.getElementById("choiceDiscount");this.preferences=t,n.style.display="block",setTimeout(function(){n.className+=" active"},0),this.changeActivityParam.product_id=e,this.changeActivityParam.activity_id=a},changeActivity:function(t){var e=this;e.changeActivityParam.activity_id!=t&&(e.changeActivityParam.activity_id=t,e.httpAjax({url:"/h5/cart/activity",param:e.changeActivityParam,success:function(t){1==t.code?(e.cartData=t.data,e.closeChoiceDiscount()):e.popup({content:t.msg})}}))},closeChoiceDiscount:function(){var t=document.getElementById("choiceDiscount");t.className=t.className.replace("active",""),setTimeout(function(){t.style.display="none"},500)},isShowCart:function(){var t=this;return 0!=t.cartData.totalQty?!0:!1},getActivityText:function(t,e){var a=["去凑单","去换购","重新换购"],n=["去凑单","选赠品","更换赠品"];return 6==t||7==t?a[e]:8==t||9==t?n[e]:void 0},goExDetail:function(t){t=t.replace(/HG|CZ/,""),location.href="/m/productDetails/productDetails.html#"+t},getType:function(t){var e={a:"china",b:"极速仓"};switch(t){case 2:break;case 1:e.a="korea",e.b="韩国仓";break;case 4:e.a="bonded",e.b="保税仓";break;case 8:e.a="korea",e.b="韩国直邮 ／特快"}return e},getWarehosesDiscountType:function(t){var e=["N元任选","满减","满减","满折","满折","超级惠","加价购","加价购","场增","场增"];return e[t]},setAdvertise:function(t,e){return e?t.replace("{","<span>").replace("}","</span>"):-1===t.id?t.name:t.advertise.replace("{",'<span class="red">').replace("}","</span>")},goUrl:function(){if(6==arguments[1]||7==arguments[1]||8==arguments[1]||9==arguments[1]){var t=arguments[3],e="";for(var a in t)e+="&"+a+"="+t[a];var n={6:"/changebuy/",7:"/changebuy/",8:"/hallgift/",9:"/hallgift/"};arguments[0]="/m/special"+n[arguments[1]]+(arguments[0].match(/(\?.+)/)&&arguments[0].match(/(\?.+)/)[0])+"&activity_id="+arguments[2]+e+"&type="+arguments[1]}arguments[0]&&(location.href=arguments[0])},goDetail:function(t){location.href=this.page+"/productDetails/productDetails.html#"+t},getProActivityType:function(t){var e={exbuy:"加价购",hallgift:"赠品"};for(var a in e)if(1==t[a])return e[a]},selectOne:function(){return document.querySelector(".mui-content input.proCheckBox:checked")?!0:!1}},ready:function(){},created:function(){this.initCart()},watch:{cartData:function(){this.selectOnePro=this.selectOne(),console.log(this.selectOnePro)}}})}});