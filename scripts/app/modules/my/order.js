define("/modules/my/order",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common"],function(e){{var r=e("/modules/vue/vue"),t=e("/modules/vue/vue-common");new r({mixins:[t],el:"html",data:{title:"订单详情",init:!1,order:null,pay:{wx:!1,ali:!1,orderId:null,global:!1,totalAmount:null,time:"",step:!1},codeToLabel:{1:"待支付",2:"待发货",3:"待收货",4:"已取消",5:"已完成",6:"待付尾款",7:"关闭"},presaleInfo:"",step:""},methods:{presaleFormatTime:function(e){var r=this,t=r.formatDate(e);return t.year+"."+t.month+"."+t.day+". "+t.hour+":"+t.minute+":"+t.second},showMyPayBox:function(){var e=this;e.paymentMethod=e.order.paymentMethod.match("支付宝")?0:1,2==e.step&&(e.isWeixin()&&"0"==e.paymentMethod||!e.isWeixin()&&"1"==e.paymentMethod)?e.popup({type:"alert",title:" ",content:"尾款支付方式需与定金一致，请回美美箱app进行操作",btn:["知道啦"]}):mui("#select-pay").popover("toggle")},initOrder:function(){var e=this;e.httpAjax({url:"/h5/order/detail",param:{orderId:e.getSearch("orderId")},success:function(r){if(1==r.code)if(r.data){e.codeToLabel[r.data.statusCode]&&(r.data.statusLabel=e.codeToLabel[r.data.statusCode]),e.order=r.data,e.presaleInfo=e.order&&e.order.orderProductInfo[0].presaleInfo;var t={grantTotal:e.order.grantTotal,time:0==e.order.closedLeftTime?"false":e.order.closedLeftTime,type:e.order.orderProductInfo[0].warehouse,orderId:e.order.realOrderId,showCloseBox:!1};e.setPresalePro(e.order,t),e.$refs.pay.payBoxInit(t),e.init=!0}else location.href="../payment/my_orders.html";else e.popup({content:r.msg}),mui.back()}})},setPresalePro:function(e,r){var t=this;1==e.isPresale&&("1"==e.statusCode?(r.step=1,r.grantTotal=t.order.orderProductInfo[0].presaleInfo.deposit):"6"==e.statusCode&&(r.step=2,t.step=2,r.grantTotal=t.order.orderProductInfo[0].presaleInfo.restPrice,r.time=t.presaleInfo.endRetainageTime-t.presaleInfo.serverTime))},getProType:function(e){var r={isGlobalProduct:"1",isLocalProduct:"2",isFtzProduct:"4"};for(var t in r)if(1==e[t])return r[t]},goPro:function(e,r){r&&r>0&&(location.href=this.page+"/productDetails/productDetails.html#"+e)},cancelOrder:function(e){var r=this;r.popup({content:"确认取消?",type:"confirm",ok:function(){r.httpAjax({url:"/h5/order/cancel",param:{orderId:e},success:function(e){1==e.code?location.href=r.page+"/payment/my_orders.html":r.popup({content:e.msg})}})}})},goOuts:function(e){location.href="/m/my/logistics.html?outsid="+e},checkout:function(){var e=this,r="/h5/payment/alipayPayment";e.isBonded()||(r="/h5/payment/globalAlipayPayment"),e.httpAjax({url:r,param:{orderId:e.order.realOrderId},success:function(r){1==r.code?location.href=r.data.url:e.popup({content:data.msg})}})},isBonded:function(){return!1},getOutsAttr:function(e){return this.order.localChildOrders&&this.order.krChildOrders&&this.order.localChildOrders[e]&&this.order.krChildOrders[e]?null:this.order.localChildOrders&&this.order.localChildOrders[e]?this.order.localChildOrders[e]:this.order.krChildOrders&&this.order.krChildOrders[e]?this.order.krChildOrders[e]:this.order[e]},addToCart:function(){for(var e,r=[],t=this,o=this.order.orderProductInfo,a=0;a<o.length;a++){if(e={},e={productId:o[a].productId,qty:o[a].qty},o[a].options[0]&&(e.options={},e.options[o[a].options[0].option_id]=o[a].options[0].value),o[a].bundleOption.length){var n=o[a].bundleOption,d=[];d.push(o[a].productId);for(var i=0;i<n.length;i++)n[i].productId&&d.push(n[i].productId);d=d.join("_"),e.productId=d}r.push(e)}this.httpAjax({url:"/h5/newcart/batchadd",param:{product:r},success:function(e){1==e.code?window.location.href="/m/cart/cart.html":t.popup({content:"部分商品已失效，未成功加入购物车",ok:function(){window.location.href="/m/cart/cart.html"}})}})},toDetail:function(){var e=this.order.orderProductInfo[0];location.href=location.origin+this.page+"/productDetails/productDetails.html#"+e.productId},isGroupon:function(e){return e.groupon_id},getPrice:function(e){var r=this,t=e.price;return"1"==e.is_GWP&&(t="0.00"),1==r.order.isGroupon&&(t=e.grouponPrice),t},getPriceTotal:function(e){var r,t=this;return r="1"!=e.isGroupon?"1"==e.is_GWP?"0.00":t.presaleInfo&&t.presaleInfo.totalPrice?t.presaleInfo.totalPrice:t.order.subtotal:e.grantTotal},presalePay:function(){var e=this;if(4==e.order.statusCode)return"5";if(e.presaleInfo){if(1==e.order.statusCode)return"1";if(e.presaleInfo.serverTime>e.presaleInfo.startRetainageTime&&6==e.order.statusCode)return"2";if(e.presaleInfo.serverTime<e.presaleInfo.startRetainageTime&&6==e.order.statusCode)return"3";if(1!=e.order.statusCode&&6!=e.order.statusCode)return"4"}},presaleStatus:function(){var e=this,r=e.order.statusCode,t=[4,1,!1,!1,4,!1,2];return t[r]||3}},created:function(){var e=this;localStorage.mmToken?e.initOrder():location.href="../account/login.html"}})}});