define("/modules/my/orders",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common","/modules/my/countdown"],function(t){var e=t("/modules/vue/vue"),o=t("/modules/vue/vue-common");t("/modules/my/countdown");new e({mixins:[o],el:"html",data:{title:"我的订单",init:!1,pageIndex:1,orders:[],isEnd:!1,tabActiveIndex:0,PAGE_SIZE:10,ORDER_STATUS:{0:"",1:"pending",2:"ready_shipement",3:"complete"},codeToLabel:{1:"待支付",2:"待发货",3:"待收货",4:"已取消",5:"已完成",6:"待付尾款",7:"关闭"},tabsInfo:{total:0,statusCount:{pending:0,ready_shipement:0,complete:0}},tabs:{0:{name:"全部订单",hasIconCount:!1,hasIconNew:!1,orders:[],pageIndex:1},1:{name:"待支付",hasIconCount:!0,hasIconNew:!1,orders:[],pageIndex:1},2:{name:"待发货",hasIconCount:!1,hasIconNew:!0,orders:[],pageIndex:1,hasClicked:!1},3:{name:"待收货",hasIconCount:!1,hasIconNew:!0,orders:[],pageIndex:1,hasClicked:!1}},pay:{wx:!1,ali:!1,global:!1,orderId:null,totalAmount:0,time:"",step:!1},nowTime:(new Date).getTime(),prompt:{type:"",show:"",price:""},canClickTab:!0,Property:{}},methods:{presaleFormatTime:function(t){var e=this,o=e.formatDate(t);return o.year+"."+o.month+"."+o.day+". "+o.hour+":"+o.minute+":"+o.second},getProPayType:function(t,e){return e&&0!=e.length?e[0].warehouse:t.warehouse},initPromptBox:function(){var t=this,e=t.getSearch("orderId");e&&!localStorage[e]&&t.httpAjax({url:"/h5/order/detail",param:{orderId:e},success:function(o){t.codeToLabel[o.data.statusCode]&&(o.data.statusLabel=t.codeToLabel[o.data.statusCode]);var o=o.data;t.prompt.price=o.grantTotal,t.prompt.type=o.paymentMethod.match("支付宝")?0:1,localStorage[e]=e,0!=Number(o.grantTotal)&&(t.prompt.show=!0),6==o.statusCode&&(t.Property.Product_id=o.orderProductInfo[0].productId,_maq.push(["_trackEvent","Depositpay_success",t.Property]),console.log(t.Property))}})},closePromptBox:function(){var t=this;t.prompt.show=!1},showPayBox:function(t){var e=this;if(console.log(t),"2"==t.step&&(e.isWeixin()&&t.paymentMethod.match("支付宝")||!e.isWeixin()&&!t.paymentMethod.match("支付宝")))e.popup({type:"alert",title:" ",content:"尾款支付方式需与定金一致，请回美美箱app进行操作",btn:["知道啦"]});else{var o=(new Date).getTime();t.time=parseInt((t.time-o)/1e3),t.time<=0&&(t.time=!1),mui("#select-pay").popover("toggle"),e.$refs.pay.payBoxInit(t)}},goOrder:function(t){location.href="/m/payment/my_order.html?orderId="+t},orderList:function(t){var e=this,o={pageIndex:e.tabs[e.tabActiveIndex].pageIndex,pageSize:e.PAGE_SIZE};o.orderStatusCode=e.tabActiveIndex,e.httpAjax({url:"/h5/order/list",param:o,showLoading:!0,success:function(a){1==a.code?(a.data?a.data.presaleInfo&&(e.tabsInfo.total=a.data.total,document.getElementsByClassName("mui-pull")[0]&&(document.getElementsByClassName("mui-pull")[0].style.visibility="visible")):e.tabsInfo.total=0,a.data=a.data||{},Array.isArray(a.data.orders)&&a.data.orders.forEach(function(t){e.codeToLabel[t.statusCode]&&(t.statusLabel=e.codeToLabel[t.statusCode])}),e.tabsInfo.statusCount=a.data.statusCount,e.tabs[e.tabActiveIndex].orders.push(a.data.orders),e.tabs[e.tabActiveIndex].pageIndex++,setTimeout(function(){new Swiper(".swiper-container",{slidesPerView:4,paginationClickable:!0,spaceBetween:10,freeMode:!0,scrollbar:".swiper-scrollbar",autoplayDisableOnInteraction:!1})},100),e.checkIcon(),t&&t(a),mui("#more").pullRefresh().endPullupToRefresh(10*o.pageIndex>=a.orderTotal?!0:!1),e.$refs.loading.show=!1,e.canClickTab=!0):e.popup({content:a.msg})}})},initOrders:function(){var t=this;t.orderList(function(){t.init=!0,mui("#more").pullRefresh({up:{contentrefresh:"正在加载...",contentnomore:"没有更多数据了",indicators:!1,callback:function(){t.orderList()}}})})},tabClick:function(t){var e=this;e.canClickTab&&(e.canClickTab=!1,document.getElementsByClassName("mui-pull")[0]&&(document.getElementsByClassName("mui-pull")[0].style.visibility="hidden"),e.clearOldData(),mui("#more").pullRefresh().scrollTo(0,0,100),this.tabActiveIndex=t,e.tabs[e.tabActiveIndex].orders.length||(e.orderList(),e.$refs.loading.show=!0))},clearOldData:function(){this.tabs[this.tabActiveIndex].orders=[],this.tabs[this.tabActiveIndex].pageIndex=1},checkIcon:function(){var t=this;switch(parseInt(t.tabActiveIndex)){case 2:t.tabs[t.tabActiveIndex].hasIconNew=!1,t.tabs[2].hasClicked=!0;break;case 3:t.tabs[t.tabActiveIndex].hasIconNew=!1,t.tabs[3].hasClicked=!0;break;default:t.tabsInfo.statusCount?(t.tabs[2].hasIconNew=!t.tabs[2].hasClicked&&t.tabs[2].hasIconNew&&t.tabsInfo.statusCount.ready_shipement?!0:!1,t.tabs[3].hasIconNew=!t.tabs[3].hasClicked&&t.tabs[3].hasIconNew&&t.tabsInfo.statusCount.complete?!0:!1,t.tabs[1].hasIconCount=t.tabs[t.tabActiveIndex].orders&&t.tabsInfo.statusCount.pending?!0:!1):(t.tabs[2].hasIconNew=!1,t.tabs[3].hasIconNew=!1)}},addToCart:function(t,e){var o,a=[],n=this;if(t){if(o={},o={productId:e.productId,qty:e.qty},e.option&&e.option.option_id&&(o.options={},o.options[e.option.option_id]=e.option.value),e.bundleOption.length&&e.hasBundleOption>0){var r=e.bundleOption,s=[];s.push(e.productId);for(var i=0;i<r.length;i++)r[i].productId&&s.push(r[i].productId);s=s.join("_"),o.productId=s}a.push(o)}else for(var c=0;c<e.length;c++)o={},o={productId:e[c].productId,qty:e[c].qty},0!=Object.keys(e[c].option).length&&(o.options={},o.options[e[c].option.option_id]=e[c].option.value),a.push(o);this.httpAjax({url:"/h5/newcart/batchadd",param:{product:a},success:function(t){1==t.code?window.location.href="/m/cart/cart.html":n.popup({content:"部分商品已失效，未成功加入购物车",ok:function(){window.location.href="/m/cart/cart.html"}})}})},cancelOrder:function(t){var e=this;t&&e.popup({content:"确认取消?",type:"confirm",ok:function(){e.httpAjax({url:"/h5/order/cancel",param:{orderId:t},success:function(t){1==t.code?location.href=e.page+"/payment/my_orders.html":e.popup({content:t.msg})}})}})},isGroupon:function(t){return 1==t.activityType},toGroup:function(t,e){e&&(localStorage.share=!0),location.href=location.origin+this.page+"/payment/group.html?grouponId="+t},toDetail:function(t){location.href=location.origin+this.page+"/productDetails/productDetails.html#"+t},getPrice:function(t){var e=t.productInfo.price;return"1"==t.is_GWP&&(e="0.00"),1==t.activityType&&(e=t.productInfo.grouponPrice),"2"==t.activityType&&(e=t.presaleInfo.prePrice),e},getDuePaid:function(t){var e=t.duePaid;return"2"==t.activityType&&(e=t.presaleInfo.totalPrice),e},showGroupDetailBtn:function(t){return"1"==t.activityType&&"9"!=t.groupoInfo.grouponStatusCode&&"7"!=t.groupoInfo.grouponStatusCode?!0:void 0}},ready:function(){mui.back=function(){location.href="../my/home.html"}},created:function(){var t=this;localStorage.mmToken?(t.initOrders(),t.initPromptBox()):location.href="../account/login.html"}})});