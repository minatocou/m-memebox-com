define("/modules/ops/birthday/index",["require","exports","module","/modules/vue/vue","/modules/vue/vue-common","/modules/app/app"],function(e){var t=e("/modules/vue/vue"),n=e("/modules/vue/vue-common"),i=e("/modules/app/app");vue=new t({mixins:[n,i],el:"html",param:null,data:{title:"Memebox 2周年庆 全场真五折",init:!1,flash:null,groupon:null,n1View:[],n2View:[],zeroView:[],tView:[],hidden:[],nowDate:null,status:["疯抢中","即将开抢","已结束"],n1Text:[{key:10,tt:"10:00",status:"即将开抢",select:!1,open:!1,timeout:!1},{key:16,tt:"16:00",status:"即将开抢",select:!1,open:!1,timeout:!1},{key:20,tt:"20:00",status:"即将开抢",select:!1,open:!1,timeout:!1}],n2Text:[],start:!1,tw:!1,selectN1:{},selectN2:{},selectCoupon:{},hid:{text:"分享解锁 神秘福利",btn:"/images/app/ops/birthday/include/hid-btn-a.png?t=20174271851",click:!1,show:!0},selectHid:null,selectTab:0,defaultTab:0,stN2:null,timer:{dd:"00",hh:"00",mm:"00",ss:"00",status:"开始",cd:0},nav:[{name:"美美福利",select:!0},{name:"超值礼盒",select:!1},{name:"极速仓专场",select:!1},{name:"保税仓专场",select:!1},{name:"直邮专场",select:!1}],coupon:{"2016-09-01":{code:"meme90650",price:"50",ext:"元",desc:"满199减50"},"2016-09-02":{code:"meme90625",price:"25",ext:"元",desc:"满99减25"},"2016-09-03":{code:"meme90605",price:"5",ext:"元",desc:"立减5元"},"2016-09-04":{code:"meme906mm",price:"5",ext:"折",desc:"限时折扣 面膜5折"},"2016-09-05":{code:"meme90630",price:"30",ext:"元",desc:"面膜满199减30"},"2016-09-06":{code:"meme90610",price:"10",ext:"元",desc:"立减10元"},"2016-09-07":{code:"meme90608",price:"8",ext:"元",desc:"立减8元"},"2016-09-08":{code:"meme906101",price:"10",ext:"元",desc:"立减10元"},"2016-09-09":{code:"meme906102",price:"10",ext:"元",desc:"立减10元"}},openText:{a:!1,b:!1},stock:{}},methods:{appShareCall:function(e){1==e.code&&this.checkTab()&&(console.log("share success"),localStorage.setItem(this.selectHid,!0),this.hid.show=!1,this.selectN2.open=!0)},format:function(e,t,n){t=t||new Date(1e3*this.nowDate),n=n||0;var i={"M+":t.getMonth()+1,"d+":t.getDate()+n,"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in i)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?i[a]:("00"+i[a]).substr((""+i[a]).length)));return e},getDateStr:function(e){return this.format("yyyy-MM-dd",null,e)},getMd:function(e){return this.format("MM月dd日",this.getDate(e))},getDate:function(e){return e=e.replace(/-/g,"/"),new Date(e)},getNowDate:function(e){return this.format("yyyy-MM-dd",e)},getHH:function(e){return this.format("hh",e)},getDay:function(){return this.format("MMdd")},checkTime:function(e){return 10>e?"0"+e:e},setTimer:function(e){e=e||this.timer.cd,e>=0?(t.set(this.timer,"dd",this.checkTime(Math.floor(e/60/60/24))),t.set(this.timer,"hh",this.checkTime(Math.floor(e/60/60%24))),t.set(this.timer,"mm",this.checkTime(Math.floor(e/60%60))),t.set(this.timer,"ss",this.checkTime(Math.floor(e%60))),t.set(this.timer,"cd",--e)):this.runCd()},getCd:function(){var e=this,t=new Date("2016/09/06").getTime()/1e3,n=new Date("2016/09/10").getTime()/1e3;e.nowDate<t?e.setTimer(t-e.nowDate):e.nowDate>=t&&e.nowDate<=n?(e.timer.status="结束",e.setTimer(n-e.nowDate)):e.nowDate>n&&(e.timer.status="")},runCd:function(){var e=this;e.getCd(),setInterval(function(){e.setTimer()},1e3)},curTab:function(e){if(this.getDay()<906){this.selectTab=e;var t=0==e?20160901:20160906;this.initN2(t)}},checkTab:function(){return this.defaultTab==this.selectTab},isStart:function(){return this.nowDate>>new Date("2016/09/01").getTime()/1e3},randerAnimation:function(e){window.scrollTo(0,e)},changeN1:function(e,t){var n=this;if(t=t||n.getNowDate(),n.flash[t]){var i=n.n1Text[e];i.select=!0;for(var a=0;a<n.n1Text.length;a++)n.tw=!1,e!=a?n.n1Text[a].select=!1:n.selectN1=n.n1Text[a];n.n1View=n.flash[t][i.key]}},changeN2:function(e){for(var t=this,n=0;n<t.n2Text.length;n++){var i=t.n2Text[n].key;i==e?t.selectN2=t.n2Text[n]:i.select=!1}t.stN2=e,t.n2View=t.hidden[e],t.hid.show=localStorage.getItem(e)?!1:!0,t.showHid(t.stN2)},tomorrow:function(){var e=this,t=e.getDateStr(1);if(e.flash[t]){e.n1View=e.flash[t][10];for(var n=0;n<e.n1Text.length;n++)e.n1Text[n].select=!1;e.tw=!0}},goN1:function(e){var t=this;return t.selectN1.open&&t.checkTab()&&1==t.stock[e.id]?t.domain+"/catalog/product/view/id/"+e.id:void 0},goN2:function(e){var t=this;return t.selectN2.open&&t.checkTab()&&1==t.stock[e.id]?t.domain+"/catalog/product/view/id/"+e.id:void 0},goPt:function(e){var t=this;return t.checkTab()&&1==t.stock[e.id]?t.domain+"/catalog/product/view/id/"+e.id:void 0},d1:function(){return 0==this.selectTab},d6:function(){return 1==this.selectTab},goGroup:function(e){location.href="/m/special/group/details.html?productId="+e},showHid:function(e){var t=this,n=e||t.getNowDate();console.log(n),t.hidden[n]&&t.nowDate>=t.getDate(n).getTime()/1e3?localStorage[n]?t.hid.show=!1:(t.hid.click=!0,t.selectHid=n,t.isApp()?(t.hid.text="分享解锁 神秘福利",t.hid.btn="/images/app/ops/birthday/include/hid-btn-b.png?t=20174271851"):(t.hid.text="下载app 查看神秘福利",t.hid.btn="/images/app/ops/birthday/include/hid-btn-c.png?t=20174271851")):t.isApp()?(t.hid.click=!1,t.hid.text="分享解锁 神秘福利",t.hid.btn="/images/app/ops/birthday/include/hid-btn-a.png?t=20174271851"):(t.hid.text="下载app 查看神秘福利",t.hid.btn="/images/app/ops/birthday/include/hid-btn-c.png?t=20174271851")},getShareData:function(){return{title:"Memebox 2周年庆 全场真五折",text:"正品韩妆，全场真5折！",url:location.href,image:location.origin+"/images/app/ops/birthday/include/wx.jpg?t=20174271851"}},hidClick:function(){var e=this;e.hid.click&&(e.isApp()&&(e.iosVer()>=360||e.androidVer()>=360)?(e.app_share(e.getShareData()),e.checkTab()&&(e.selectHid=e.stN2,_hmt.push(["_trackEvent","大促页面","分享隐藏成功"]),setTimeout(function(){e.appShareCall({code:1})},8e3))):(_hmt.push(["_trackEvent","大促页面","大促下载成功"]),e.getAppUrl()))},initN1:function(e,t){var n=this;if(t=t||n.getNowDate(),e=e||n.getHH(),n.flash[t]||(t="2016-09-01",e="00"),n.flash[t]){n.start=!0;for(var i=n.n1Text[0].key,a=0;a<n.n1Text.length;a++){var o=n.n1Text[a];e>=20?a==n.n1Text.length-1?(o.status=n.status[0],o.open=!0,o.select=!0,i=n.n1Text[a].key,n.selectN1=o):(o.status=n.status[2],o.timeout=!0):10>e?(o.status=n.status[1],n.n1Text[0].select=!0,n.selectN1=o):e>=o.key&&e<n.n1Text[a+1].key?(o.status=n.status[0],o.open=!0,o.select=!0,n.selectN1=o,i=n.n1Text[a].key):e>o.key&&(o.status=n.status[2],o.timeout=!0)}n.n1View=n.flash[t][i]}},initN2:function(){var e=this,t=e.getNowDate();if(e.hidden[t]){e.$set("n2Text",[]);for(var n in e.hidden){var i=n.replace(/-/g,"");if(e.d1()&&i>=20160901&&20160905>=i||e.d6()&&i>=20160906&&20160909>=i){var a={};e.n2View=e.hidden[t],a.key=n,n==t?(a.open=!0,a.select=!0,e.selectN2=a,e.selectCoupon=e.coupon[n],e.stN2=n):(a.open=localStorage.getItem(n)?!0:!1,a.select=!1),e.n2Text.push(a)}}}},initZero:function(){var e=this;e.zeroView=e.flash["2016-09-06"]["00"]},initTView:function(){var e=this;e.tView=e.hidden["1970-01-01"]},changeNav:function(e,t){var n=this,i=document.querySelectorAll(".link");if(i[e]){t.select=!0;for(var a in n.nav)a!=e&&(n.nav[a].select=!1);requestAnimationFrame(function(){document.body.scrollTop<i[e].offsetTop-50?(n.randerAnimation(document.body.scrollTop+100),document.body.scrollTop<i[e].offsetTop-50&&document.body.offsetHeight-window.innerHeight>document.body.scrollTop?requestAnimationFrame(arguments.callee):cancelAnimationFrame(arguments.callee)):(n.randerAnimation(document.body.scrollTop-100),document.body.scrollTop>=i[e].offsetTop?requestAnimationFrame(arguments.callee):cancelAnimationFrame(arguments.callee))})}},initScroll:function(){window.onscroll=function(){for(var e=document.querySelectorAll(".link"),t=document.body.scrollTop+window.innerHeight,n=0;n<vue.nav.length;n++)vue.nav[n].select=!1;for(var n=0;n<e.length;n++)e[n]&&e[n+1]?t>=e[n].offsetTop&&t<=e[n+1].offsetTop&&(vue.nav[n].select=!0):n==e.length-1&&t>=e[n].offsetTop&&(vue.nav[n].select=!0)}},initData:function(e){var t=this;t.nowDate=t.getSearch("d")?new Date("2016/09/0"+t.getSearch("d")+" "+t.getSearch("t")+":00").getTime()/1e3:e.data.nowDate,t.init=!0,t.flash=e.data.flash,t.groupon=e.data.groupon,t.hidden=e.data.hidden,t.initStock();var n=new Date("2016/09/06").getTime()/1e3;t.defaultTab=t.selectTab=t.nowDate<n?0:1;var i=t.getShareData();t.isApp()&&(t.iosVer()>=360||t.androidVer()>=360)&&t.app_setShare(i),i.success=function(){vue.appShareCall({code:1})},t.set_share(i)},initStock:function(){var e=this,t=e.getNowDate(),n=[];if(e.flash[t])for(var i in e.flash[t])for(var a=0;a<e.flash[t][i].length;a++){var o=e.flash[t][i][a];n.push(o.id)}for(var i in e.hidden)if(e.nowDate>=e.getDate(i).getTime()/1e3){var s;s="1970-01-01"==i?4:e.hidden[i].length;for(var a=0;s>a;a++)n.push(e.hidden[i][a].id)}e.httpAjax({url:"/global/price",domain:e.searchDomain,param:{productIds:n.join(",")},success:function(t){if(1==t.code&&t.data){for(var n=0;n<t.data.length;n++){var i=t.data[n];1==i.stockStatus&&(e.stock[i.productId]=i.stockStatus)}e.initN1(),e.initN2(),e.initZero(),e.initTView(),e.showHid(),e.initScroll()}else alert(t.msg)}})}},ready:function(){},created:function(){var e=this;e.httpAjax({url:"/global/activity",domain:e.searchDomain,success:function(t){1==t.code&&t.data&&t.data.hidden?(e.initData(t),e.runCd()):e.httpAjax({url:"/h5/flash/index",success:function(t){1==t.code&&t.data&&t.data.hidden?(e.initData(t),e.runCd()):alert(t.msg)}})},error:function(){e.httpAjax({url:"/h5/flash/index",success:function(t){1==t.code&&t.data&&t.data.hidden?(e.initData(t),e.runCd()):alert(t.msg)}})}})}})});