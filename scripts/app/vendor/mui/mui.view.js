!function(t){var e=t.className("left"),a=t.className("center"),s=t.className("right"),i=t.className("page"),r=t.className("page-left"),n=t.className("page-center"),h=t.className("navbar-left"),o=t.className("navbar-center"),c=t.className("page-shadow"),v=t.className("transitioning"),l="."+e,g="."+a,p="."+s,u=t.classSelector(".icon"),d=t.classSelector(".navbar"),f=t.classSelector(".navbar-inner"),m=t.classSelector(".pages"),b=t.classSelector(".btn-nav"),N="."+r,y="."+n,_="."+h,P="."+o,S=t.Class.extend({init:function(e,a){this.view=this.element=e,this.options=t.extend({animateNavbar:"ios",swipeBackPageActiveArea:30,hardwareAccelerated:!0},a),this.navbars=this.view.querySelector(d),this.pages=this.view.querySelector(m),this.history=[],this.maxScrollX=this.view.offsetWidth,this.x=this.y=0,this.translateZ=this.options.hardwareAccelerated?" translateZ(0)":"",this.ratio=0,this.isBack=!0,this.moved=this.dragging=!1,this.activeNavbar=this.previousNavbar=null,this.activePage=this.previousPage=null,this._initPageEventMethod(),this._initDefaultPage(),this.navbars&&this._initNavBar(),this.initEvent()},_initPageEventMethod:function(){var e=this;t.each(["onPageBeforeShow","onPageShow","onPageBeforeBack","onPageBack"],function(t,a){e[a+"Callbacks"]={},e[a]=function(t,s){var i=a+"Callbacks";e[i].hasOwnProperty(t)?e[i][t].push(s):e[i][t]=[s]}})},_initDefaultPage:function(){var t=document.querySelector(this.options.defaultPage);if(!t)throw new Error("defaultPage["+this.options.defaultPage+"] does not exist");this._appendPage(t)},initEvent:function(){this.view.addEventListener("click",this),this.view.addEventListener("tap",this),this.pages.addEventListener("drag",this),this.pages.addEventListener("dragend",this),this.pages.addEventListener("webkitTransitionEnd",this)},handleEvent:function(t){switch(t.type){case"click":this._click(t);break;case"tap":this._tap(t);break;case"drag":this._drag(t);break;case"dragend":this._dragend(t);break;case"webkitTransitionEnd":this._webkitTransitionEnd(t)}},shadow:function(){var t=document.createElement("div");return t.className=c,t}(),_removePage:function(t,e){e&&this._removeNavbar(t,e),document.body.appendChild(t),this._cleanPageClass(t)},_prependPage:function(t){var e=t.querySelector(f);e&&this._prependNavbar(e),t.classList.add(r),this.pages.insertBefore(t,this.pages.firstElementChild)},_appendPage:function(t){var e=t.querySelector(f);e&&this._appendNavbar(e),t.classList.add(n),this.pages.appendChild(t)},_removeNavbar:function(t,e){t.insertBefore(e,t.firstElementChild),this._cleanNavbarClass(e)},_prependNavbar:function(t){t.classList.add(h),this.navbars.insertBefore(t,this.navbars.firstElementChild)},_appendNavbar:function(t){t.classList.add(o),this.navbars.appendChild(t)},_cleanPageClass:function(t){t.classList.remove(n),t.classList.remove(r)},_cleanNavbarClass:function(t){t.classList.remove(o),t.classList.remove(h)},_tap:function(t){for(var e=t.target;e&&e!==document;e=e.parentNode)if("A"===e.tagName&&e.hash){var a=document.getElementById(e.hash.replace("#",""));if(a&&a.classList.contains(i)){t.stopPropagation(),t.detail.gesture.preventDefault(),this.go(e.hash);break}}},_click:function(t){for(var e=t.target;e&&e!==document;e=e.parentNode)if("A"===e.tagName&&e.hash){var a=document.getElementById(e.hash.replace("#",""));if(a&&a.classList.contains(i)){t.preventDefault();break}}},_cleanStyle:function(t){t&&(t.style.webkitTransform="",t.style.opacity="")},_isAnimateNavbarIOS:function(){return t.os.ios&&"ios"===this.options.animateNavbar},_webkitTransitionEnd:function(e){if(this.dragging=this.moved=!1,this.activePage===e.target){this.isInTransition=!1,this.shadow.parentNode===this.activePage&&this.activePage.removeChild(this.shadow),this.previousPageClassList.remove(v),this.activePageClassList.remove(v);var a=this;if(this._isAnimateNavbarIOS()&&this.previousNavElements&&this.activeNavElements){var s=this.isBack;t.each(this.previousNavElements,function(t,e){e.classList.remove(v),s&&a._cleanStyle(e)}),t.each(this.activeNavElements,function(t,e){e.classList.remove(v),a._cleanStyle(e)}),this.previousNavBackIcon&&(this.previousNavBackIcon.classList.remove(v),s&&this._cleanStyle(this.previousNavBackIcon)),this.activeNavBackIcon&&(this.activeNavBackIcon.classList.remove(v),this._cleanStyle(this.activeNavBackIcon))}else this.previousNavbar&&this.previousNavbar.classList.remove(v),this.activeNavbar&&this.activeNavbar.classList.remove(v),this._cleanStyle(this.previousNavbar),this._cleanStyle(this.activeNavbar);this._cleanStyle(this.previousPage),this._cleanStyle(this.activePage),this.ratio<=.5||(this.isBack?(this._removePage(this.activePage,this.activeNavbar),this.previousPageClassList.remove(r),this.previousPageClassList.add(n),this.previousNavbar&&(this.previousNavbar.classList.remove(h),this.previousNavbar.classList.add(o)),this.history.length>0&&this._prependPage(this.history.pop()),this.navbars&&this._initNavBar(),this._trigger("pageBack",this.activePage),this._trigger("pageShow",this.previousPage)):(this.previousPageClassList.add(r),this.activePageClassList.add(n),this._trigger("pageShow",this.activePage)))}},_trigger:function(e,a){var s="on"+e.charAt(0).toUpperCase()+e.slice(1)+"Callbacks";if(this[s].hasOwnProperty(a.id))for(var i=this[s][a.id],r=new CustomEvent(e,{detail:{page:a},bubbles:!0,cancelable:!0}),n=i.length;n--;)i[n].apply(this,r);t.trigger(this.view,e,{page:a})},_initPageTransform:function(){return this.previousPage=this.pages.querySelector(N),this.activePage=this.pages.querySelector(y),this.previousPage&&this.activePage?(this.activePage.appendChild(this.shadow),this.previousPageClassList=this.previousPage.classList,this.activePageClassList=this.activePage.classList,this.previousPageStyle=this.previousPage.style,this.activePageStyle=this.activePage.style,this.previousPageClassList.remove(v),this.activePageClassList.remove(v),this.navbars&&(this.previousNavbar=this.navbars.querySelector(_),this.activeNavbar=this.navbars.querySelector(P),this._isAnimateNavbarIOS()&&this.previousNavbar&&this.activeNavbar&&(this.previousNavElements=this.previousNavbar.querySelectorAll(l+","+g+","+p),this.activeNavElements=this.activeNavbar.querySelectorAll(l+","+g+","+p),this.previousNavBackIcon=this.previousNavbar.querySelector(l+b+" "+u),this.activeNavBackIcon=this.activeNavbar.querySelector(l+b+" "+u))),this.x=0,this.dragging=!0,!0):!1},_initNavBar:function(){if(this._isAnimateNavbarIOS()&&this.navbars)for(var t,e,a,s,i,r,n,h,o,c,v,u=this.navbars.querySelectorAll(f),d=0,m=u.length;m>d;d++){t=u[d],e=t.querySelector(l),a=t.querySelector(p),s=t.querySelector(g),h=!e,noRight=!a,i=h?0:e.offsetWidth,r=noRight?0:a.offsetWidth,n=s?s.offsetWidth:0,v=this.maxScrollX,onLeft=t.classList.contains("navbar-left"),noRight&&(o=v-n),h&&(o=0),h||noRight||(o=(v-r-n+i)/2);var b=(v-n)/2;v-i-r>n?(i>b&&(b=i),b+n>v-r&&(b=v-r-n),c=b-o):c=0;s&&(s.style.marginLeft=-i+"px",s.mNavbarLeftOffset=-(o+c)+30,s.mNavbarRightOffset=v-o-c-n),onLeft&&(s.style.webkitTransform="translate3d("+s.mNavbarLeftOffset+"px, 0, 0)"),h||(e.mNavbarLeftOffset=-i,e.mNavbarRightOffset=(v-i)/2,onLeft&&(e.style.webkitTransform="translate3d("+e[0].mNavbarLeftOffset+"px, 0, 0)")),noRight||(a.mNavbarLeftOffset=-(v-r)/2,a.mNavbarRightOffset=r,onLeft&&(a.style.webkitTransform="translate3d("+a[0].mNavbarLeftOffset+"px, 0, 0)"))}},_drag:function(e){if(!this.isInTransition){var a=e.detail;if(this.dragging||t.gestures.session.firstTouch.center.x-this.view.offsetLeft<this.options.swipeBackPageActiveArea&&(this.isBack=!0,this._initPageTransform()),this.dragging){var s=0;this.moved?s=a.deltaX-(t.gestures.session.prevTouch&&t.gestures.session.prevTouch.deltaX||0):(s=a.deltaX,t.gestures.session.lockDirection=!0,t.gestures.session.startDirection=a.direction);var i=this.x+s;(0>i||i>this.maxScrollX)&&(i=0>i?0:this.maxScrollX),e.stopPropagation(),a.gesture.preventDefault(),this.requestAnimationFrame||this._updateTranslate(),this.moved=!0,this.x=i,this.y=0}}},_dragend:function(e){if(this.moved){e.stopPropagation();{e.detail}return this._clearRequestAnimationFrame(),this._prepareTransition(),this.ratio=this.x/this.maxScrollX,1===this.ratio||0===this.ratio?void t.trigger(this.activePage,"webkitTransitionEnd"):void(this.ratio>.5?this.setTranslate(this.maxScrollX,0):(this._cleanStyle(this.previousPage),this._cleanStyle(this.activePage)))}},_prepareTransition:function(){this.isInTransition=!0,this.previousPageClassList.add(v),this.activePageClassList.add(v);var e=this;this.previousNavbar&&this.activeNavbar&&(this.previousNavbar.classList.add(v),this.activeNavbar.classList.add(v),this._isAnimateNavbarIOS()&&this.previousNavElements&&this.activeNavElements&&(t.each(this.previousNavElements,function(t,a){a.classList.add(v),e._cleanStyle(a)}),t.each(this.activeNavElements,function(t,a){a.classList.add(v),e._cleanStyle(a)}),this.previousNavBackIcon&&(this._cleanStyle(this.previousNavBackIcon),this.previousNavBackIcon.classList.add(v)),this.activeNavBackIcon&&(this._cleanStyle(this.activeNavBackIcon),this.activeNavBackIcon.classList.add(v))))},_clearRequestAnimationFrame:function(){this.requestAnimationFrame&&(cancelAnimationFrame(this.requestAnimationFrame),this.requestAnimationFrame=null)},_getTranslateStr:function(t,e){return this.options.hardwareAccelerated?"translate3d("+t+"px,"+e+"px,0px) "+this.translateZ:"translate("+t+"px,"+e+"px) "},_updateTranslate:function(){var t=this;(t.x!==t.lastX||t.y!==t.lastY)&&t.setTranslate(t.x,t.y),t.requestAnimationFrame=requestAnimationFrame(function(){t._updateTranslate()})},_setNavbarTranslate:function(t){var e=t/this.maxScrollX;this._isAnimateNavbarIOS()?this.previousNavElements&&this.activeNavElements&&this.animateNavbarByIOS(e):(this.activeNavbar.style.opacity=1-1.3*e,this.previousNavbar.style.opacity=1.3*e-.3)},animateNavbarByIOS:function(t){var a,i,r,n;for(a=0,i=this.activeNavElements.length;i>a;a++)if(n=this.activeNavElements[a],r=n.style,r.opacity=1-t*(n.classList.contains(e)?3.5:1.3),!n.classList.contains(s)){var h=t*n.mNavbarRightOffset;n.style.webkitTransform="translate3d("+h+"px,0,0)",n.classList.contains(e)&&this.activeNavBackIcon&&(this.activeNavBackIcon.style.webkitTransform="translate3d("+-h+"px,0,0)")}for(a=0,i=this.previousNavElements.length;i>a;a++)if(n=this.previousNavElements[a],r=n.style,r.opacity=1.3*t-.3,!n.classList.contains(s)){var o=n.mNavbarLeftOffset*(1-t);n.style.webkitTransform="translate3d("+o+"px,0,0)",n.classList.contains(e)&&this.previousNavBackIcon&&(this.previousNavBackIcon.style.webkitTransform="translate3d("+-o+"px,0,0)")}},setTranslate:function(t,e){this.x=t,this.y=e,this.previousPage.style.opacity=.9+.1*t/this.maxScrollX,this.previousPage.style.webkitTransform=this._getTranslateStr(t/6-this.maxScrollX/6,e),this.activePage.style.webkitTransform=this._getTranslateStr(t,e),this.navbars&&this._setNavbarTranslate(t,e),this.lastX=this.x,this.lastY=this.y},canBack:function(){return this.pages.querySelector(N)},back:function(){this.isInTransition||(this.isBack=!0,this.ratio=1,this._initPageTransform()&&(this._trigger("pageBeforeBack",this.activePage),this._trigger("pageBeforeShow",this.previousPage),this._prepareTransition(),this.previousPage.offsetHeight,this.activePage.offsetHeight,this.setTranslate(this.maxScrollX,0)))},go:function(t){if(!this.isInTransition){var e=document.querySelector(t);if(e){var a,s,i=this.pages.querySelector(N),c=this.pages.querySelector(y);this.navbars&&(a=this.navbars.querySelector(_),s=this.navbars.querySelector(P)),s&&(s.classList.remove(o),s.classList.add(h)),i&&(this._removePage(i,a),this.history.push(i)),c&&(c.classList.remove(n),c.style.webkitTransform="translate3d(0,0,0)",c.classList.add(r)),e.style.webkitTransform="translate3d(100%,0,0)",this._appendPage(e),e.appendChild(this.shadow),e.offsetHeight,this.isBack=!1,this.ratio=1,this._initPageTransform(),this.navbars&&this._initNavBar(),this.navbars&&this._setNavbarTranslate(this.maxScrollX,0),this.previousPage.offsetHeight,this.activePage.offsetHeight,this.navbars&&(this.previousNavbar.offsetHeight,this.activeNavbar.offsetHeight),this._trigger("pageBeforeShow",this.activePage),this._prepareTransition(),this.setTranslate(0,0)}}}});t.fn.view=function(e){var a=this[0],s=null,i=a.getAttribute("data-view");return i?s=t.data[i]:(i=++t.uuid,t.data[i]=s=new S(a,e),a.setAttribute("data-view",i)),s}}(mui,window);